var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__typeError=e=>{throw TypeError(e)},__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__publicField=(e,t,r)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,r),__accessCheck=(e,t,r)=>t.has(e)||__typeError("Cannot "+r),__privateGet=(e,t,r)=>(__accessCheck(e,t,"read from private field"),r?r.call(e):t.get(e)),__privateAdd=(e,t,r)=>t.has(e)?__typeError("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),__privateSet=(e,t,r,s)=>(__accessCheck(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),__privateMethod=(e,t,r)=>(__accessCheck(e,t,"access private method"),r),__async=(e,t,r)=>new Promise(((s,n)=>{var i=e=>{try{o(r.next(e))}catch(t){n(t)}},a=e=>{try{o(r.throw(e))}catch(t){n(t)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,a);o((r=r.apply(e,t)).next())}));!function(){"use strict";var e,t,r,s,n,i,a,o;!function(){if(window.__IBN_LOADER_SCHEDULED__)return;window.__IBN_LOADER_SCHEDULED__=!0;const e=new Set;function t(t){const r={pubId:t.getAttribute("data-pubid"),slot:t.getAttribute("data-slotId"),templateId:t.getAttribute("data-templateId"),domain:t.getAttribute("data-domain"),adUnitId:t.getAttribute("data-divId"),keywords:t.getAttribute("data-keywords")||""};if(!r.pubId||!r.templateId||!r.adUnitId)return null;if(e.has(r.adUnitId))return null;e.add(r.adUnitId);const s=document.getElementById(r.adUnitId);return s?(s.classList.add("adg_native_ibn"),Object.entries(r).forEach((([e,t])=>{s.setAttribute(`data-${e}`,t)})),r):null}function r(e){return __async(this,null,(function*(){if(e&&0!==e.length)try{const{IBNLoader:r}=yield Promise.resolve().then((()=>fe)),{extractPageKeywords:s}=yield Promise.resolve().then((()=>ve)),{getGlobalWorkerManager:n,getGlobalNetworkService:i}=yield Promise.resolve().then((()=>Te)),a=n(),o=i();let l="";try{l=yield s()}catch(t){console.warn("Keyword extraction failed:",t)}const c=e[0].domain,d=c&&""!==c.trim()?c.trim():null;new r({pubId:e[0].pubId,data_domain:d,keywords:l,divs:e.map((e=>e.adUnitId))},o,a)}catch(r){console.error("[IBN.js] Loader error:",r)}}))}const s=document.querySelectorAll('script[id^="afpftpPixel_"][data-pubid][data-divId][data-templateId]'),n=[];for(const i of s){const e=t(i);e&&n.push(e)}r(n);new MutationObserver((e=>{var s;const n=[];for(const r of e)for(const e of r.addedNodes)if("SCRIPT"===e.tagName&&(null==(s=e.id)?void 0:s.startsWith("afpftpPixel_"))){const r=t(e);r&&n.push(r)}n.length>0&&r(n)})).observe(document.body,{childList:!0,subtree:!0})}();const l=new class{constructor({enabled:e=!1,logEndpoint:t="",logLevel:r="debug"}={}){this.enabled=e,this.logEndpoint=t,this.logLevel=r,this.levels=["debug","info","warn","error"],this.groupLevel=0}log(e,...t){if(!this.enabled)return;if(this.levels.indexOf(e)<this.levels.indexOf(this.logLevel))return;const r=(new Date).toISOString();console[e](`[${r}]`,...t),this.logEndpoint&&this.sendToServer(e,t)}debug(...e){this.log("debug",...e)}info(...e){this.log("info",...e)}warn(...e){this.log("warn",...e)}error(...e){this.log("error",...e)}metric(...e){this.log("warn",...e)}group(e=""){if(!this.enabled)return;if(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel))return;const t=(new Date).toISOString(),r="  ".repeat(this.groupLevel);console.group(`[${t}] ${r}${e}`),this.groupLevel++}groupEnd(){this.enabled&&(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel)||this.groupLevel>0&&(this.groupLevel--,console.groupEnd()))}sendToServer(e,t){fetch(this.logEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:t.join(" "),timestamp:(new Date).toISOString()})}).catch((e=>logger.error("Logger server error",e)))}}({enabled:!0,logEndpoint:"",logLevel:"error"}),c=new class{constructor(e=50){this.caches=new Map([["IBN",new Map],["OCEAN",new Map],["NANO",new Map]]),this.cacheMetadata=new Map,this.enabledCaches=new Set(["OCEAN"]),this.maxSize=e,this.debug=!0,this.sizeCache=new WeakMap}addToCache(e,t,r){if(!this.enabledCaches.has(e))return;const s=this.caches.get(e),n=Date.now();if(s.size>=this.maxSize){let t=1/0,r=null;for(const[n,i]of s.entries()){const s=this.cacheMetadata.get(`${e}:${n}`);s&&s.timestamp<t&&(t=s.timestamp,r=n)}r&&(l.group("Cache Eviction"),l.info(`Evicting key: ${r} from ${e} cache`),l.info(`Age: ${(n-t)/1e3}s`),l.groupEnd(),s.delete(r),this.cacheMetadata.delete(`${e}:${r}`),this.sizeCache.delete(r))}const i=null==t?void 0:t.variation;void 0!==i&&(s.set(i,r),this.cacheMetadata.set(`${e}:${i}`,{timestamp:n,size:this.calculateDataSize(r)}),this.debug&&(l.group("Cache Addition"),l.info(`Added to ${e} cache:`),l.info("Key:",i),l.info("Data size:",this.getDataSize(r)),l.groupEnd()))}calculateDataSize(e){try{return JSON.stringify(e).length}catch(t){return 0}}getFromCache(e,t){if(!this.enabledCaches.has(e))return null;const r=this.caches.get(e),s=null==t?void 0:t.variation;let n=void 0!==s?r.get(s):null;return n||(n=r.get("0")),this.debug&&(l.group("Cache Retrieval"),l.info(`Attempting to get from ${e} cache:`),l.info("Key:",t),l.info("Found:",null!==n),n&&l.log("Data size:",this.getDataSize(n)),l.groupEnd()),n}getDataSize(e){if(!e)return"0 KB";let t=this.sizeCache.get(e);if(void 0===t)try{t=`${(JSON.stringify(e).length/1024).toFixed(2)} KB`,this.sizeCache.set(e,t)}catch(r){t="Unable to calculate size"}return t}getSize(e){try{const t=this.caches.get(e);return t?t.size:"Unable to calculate size"}catch(t){return"Unable to calculate size"}}getTotalDataSize(e){let t=0;for(const s of e.values())try{t+=JSON.stringify(s).length}catch(r){l.warn("Unable to calculate size for cache entry")}return`${(t/1024).toFixed(2)} KB`}getCacheStats(){const e={};for(const[t,r]of this.caches.entries())e[t]={enabled:this.enabledCaches.has(t),size:r.size,keys:Array.from(r.keys()),totalDataSize:this.getTotalDataSize(r),maxSize:this.maxSize};return e}hasInCacheAndKey(e,t){return this.enabledCaches.has(e)&&this.caches.get(e).has(t)}hasInCache(e){return this.enabledCaches.has(e)}enableCache(e){this.enabledCaches.add(e)}disableCache(e){this.enabledCaches.delete(e)}clearCache(e){if(e){const t=this.caches.get(e);if(t){for(const e of t.values())this.sizeCache.delete(e);t.clear()}}else this.caches.forEach((e=>{for(const t of e.values())this.sizeCache.delete(t);e.clear()}))}}(5);function d(){let e=new Date,t=(e.getFullYear()+"").substring(2),r=e.getMonth()+1;r<10&&(r="0"+r);let s=e.getDate();s<10&&(s="0"+s);let n=e.getHours();return n<10&&(n="0"+n),parseInt(t+""+r+s+n)}function h(){let e="";try{e=window.location!==window.parent.location?document.referrer:window.location.href,l.info("refer url in try: "+e)}catch(t){e=document.referrer||window.location.href,l.info("refer url in catch: "+e)}return l.info("final refer url: "+e),e}"https://adgebra.co.in".split(",").map((e=>e.trim())).filter(Boolean);const u="https://adgebra.co.in/impressiontracker/widget-imp",p="https://adgebra.co.in/impressiontracker/viewable-imp",m="https://adgebra.co.in/impressiontracker/pre-fetch-imp",g=[];for(let Ie=0;Ie<256;++Ie)g.push((Ie+256).toString(16).slice(1));let f;const y=new Uint8Array(16);const b={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function v(e,t,r){var s,n,i;if(b.randomUUID&&!e)return b.randomUUID();const a=null!=(i=null!=(n=(e=e||{}).random)?n:null==(s=e.rng)?void 0:s.call(e))?i:function(){if(!f){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");f=crypto.getRandomValues.bind(crypto)}return f(y)}();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=15&a[6]|64,a[8]=63&a[8]|128,function(e,t=0){return(g[e[t+0]]+g[e[t+1]]+g[e[t+2]]+g[e[t+3]]+"-"+g[e[t+4]]+g[e[t+5]]+"-"+g[e[t+6]]+g[e[t+7]]+"-"+g[e[t+8]]+g[e[t+9]]+"-"+g[e[t+10]]+g[e[t+11]]+g[e[t+12]]+g[e[t+13]]+g[e[t+14]]+g[e[t+15]]).toLowerCase()}(a)}class w{constructor(e,t=null){this.WorkerConstructor=e,this.poolSize=t||(navigator.hardwareConcurrency||1),l.info(`Creating worker pool with size: ${this.poolSize}`),this.workers=[],this.queue=[],this.activeWorkers=new Map,this.initialize()}initialize(){for(let e=0;e<this.poolSize;e++){const t=new this.WorkerConstructor;t.id=e,t.busy=!1,t.onmessage=e=>{this.handleWorkerMessage(t,e)},t.onerror=e=>{l.error(`Worker ${t.id} error:`,e),this.handleWorkerError(t,e)},this.workers.push(t)}}executeTask(e,t){return __async(this,null,(function*(){return new Promise(((r,s)=>{const n={data:e,resolve:r,reject:s};if(t){if(t.aborted){const e=t.reason||new DOMException("Aborted","AbortError"),r=this.getError(e);return s(r)}const e=()=>{const e=this.queue.indexOf(n);if(-1===e)n.worker&&(n.worker.postMessage({type:"ABORT",taskId:n.taskId,reason:t.reason}),n.aborted=!0);else{this.queue.splice(e,1);const r=t.reason||new DOMException("Aborted","AbortError"),n=this.getError(r);s(n)}};t.addEventListener("abort",e),n.abortCleanup=()=>{t.removeEventListener("abort",e)}}const i=this.workers.find((e=>!e.busy));i?this.assignTaskToWorker(i,n):this.queue.push(n)}))}))}assignTaskToWorker(e,t){e.busy=!0,t.taskId=t.taskId||`task-${Date.now()}-${v()}`,this.activeWorkers.set(e,t);const r=__spreadProps(__spreadValues({},t.data),{taskId:t.taskId,requestId:t.taskId});e.postMessage(r)}handleWorkerMessage(e,t){const r=this.activeWorkers.get(e);if(!r)return;const s=t.data.taskId||t.data.requestId,n=r.taskId;s&&s!==n||(this._resolveTask(r,t.data),r.abortCleanup&&r.abortCleanup(),this.activeWorkers.delete(e),e.busy=!1,this._processNextTask(e))}_resolveTask(e,t){"ABORTED"===t.type&&e.aborted?e.reject(new DOMException("Aborted","AbortError")):e.resolve(t)}_processNextTask(e){if(0===this.queue.length)return;const t=this.queue.shift();this.assignTaskToWorker(e,t)}handleWorkerError(e,t){const r=this.activeWorkers.get(e);if(r&&(r.reject(t),this.activeWorkers.delete(e),e.busy=!1,this.queue.length>0)){const t=this.queue.shift();this.assignTaskToWorker(e,t)}}terminate(){this.workers.forEach((e=>e.terminate())),this.workers=[],this.queue=[],this.activeWorkers.clear()}getError(e){return e instanceof Error||e instanceof DOMException?e:new Error(e)}}const _='var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__async=(e,t,r)=>new Promise(((o,s)=>{var n=e=>{try{i(r.next(e))}catch(t){s(t)}},l=e=>{try{i(r.throw(e))}catch(t){s(t)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,l);i((r=r.apply(e,t)).next())}));!function(){"use strict";new class{constructor({enabled:e=!1,logEndpoint:t="",logLevel:r="debug"}={}){this.enabled=e,this.logEndpoint=t,this.logLevel=r,this.levels=["debug","info","warn","error"],this.groupLevel=0}log(e,...t){if(!this.enabled)return;if(this.levels.indexOf(e)<this.levels.indexOf(this.logLevel))return;const r=(new Date).toISOString();console[e](`[${r}]`,...t),this.logEndpoint&&this.sendToServer(e,t)}debug(...e){this.log("debug",...e)}info(...e){this.log("info",...e)}warn(...e){this.log("warn",...e)}error(...e){this.log("error",...e)}metric(...e){this.log("warn",...e)}group(e=""){if(!this.enabled)return;if(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel))return;const t=(new Date).toISOString(),r="  ".repeat(this.groupLevel);console.group(`[${t}] ${r}${e}`),this.groupLevel++}groupEnd(){this.enabled&&(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel)||this.groupLevel>0&&(this.groupLevel--,console.groupEnd()))}sendToServer(e,t){fetch(this.logEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:t.join(" "),timestamp:(new Date).toISOString()})}).catch((e=>logger.error("Logger server error",e)))}}({enabled:!0,logEndpoint:"",logLevel:"error"});const e="https://adgebra.co.in".split(",").map((e=>e.trim())).filter(Boolean);function t(e){try{return decodeURIComponent(e.replace(/\\+/g," "))}catch(t){return e}}self.addEventListener("message",(function(r){return __async(this,null,(function*(){var o;if(r.origin&&!e.includes(r.origin))return;if((null==(o=r.data)?void 0:o.source)&&!e.includes(r.data.source))return;const{type:s,data:n}=r.data;switch(s){case"PROCESS_OCEAN_DATA":const e=function(e){const{oceanAds:r,oceanArticles:o}=e;return{ads:r.map((e=>__spreadProps(__spreadValues({},e),{title:t(e.title),pnTitle:e.pnTilte?t(e.pnTilte):"",ctaMessage:e.ctaMessage?t(e.ctaMessage):"",trackerUrl:decodeURIComponent(e.trackerUrl)}))),articles:o?o.map((e=>__spreadProps(__spreadValues({},e),{title:t(e.title)}))):[]}}(n);self.postMessage({type:"PROCESSED_OCEAN_DATA",data:e});break;case"PREPARE_CONTENT":const r=function(e){return __spreadProps(__spreadValues({},e),{processedAt:Date.now()})}(n);self.postMessage({type:"PREPARED_CONTENT",data:r})}}))}))}();\n//# sourceMappingURL=oceanWorker-B9ZG-emr.js.map\n',k="undefined"!=typeof self&&self.Blob&&new Blob([_],{type:"text/javascript;charset=utf-8"});function T(e){let t;try{if(t=k&&(self.URL||self.webkitURL).createObjectURL(k),!t)throw"";const r=new Worker(t,{name:null==e?void 0:e.name});return r.addEventListener("error",(()=>{(self.URL||self.webkitURL).revokeObjectURL(t)})),r}catch(r){return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(_),{name:null==e?void 0:e.name})}finally{t&&(self.URL||self.webkitURL).revokeObjectURL(t)}}const I='var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t));!function(){"use strict";function e(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}function t(e){return{type:"ABORTED",message:"Task was aborted",taskId:e}}new class{constructor({enabled:e=!1,logEndpoint:t="",logLevel:r="debug"}={}){this.enabled=e,this.logEndpoint=t,this.logLevel=r,this.levels=["debug","info","warn","error"],this.groupLevel=0}log(e,...t){if(!this.enabled)return;if(this.levels.indexOf(e)<this.levels.indexOf(this.logLevel))return;const r=(new Date).toISOString();console[e](`[${r}]`,...t),this.logEndpoint&&this.sendToServer(e,t)}debug(...e){this.log("debug",...e)}info(...e){this.log("info",...e)}warn(...e){this.log("warn",...e)}error(...e){this.log("error",...e)}metric(...e){this.log("warn",...e)}group(e=""){if(!this.enabled)return;if(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel))return;const t=(new Date).toISOString(),r="  ".repeat(this.groupLevel);console.group(`[${t}] ${r}${e}`),this.groupLevel++}groupEnd(){this.enabled&&(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel)||this.groupLevel>0&&(this.groupLevel--,console.groupEnd()))}sendToServer(e,t){fetch(this.logEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:t.join(" "),timestamp:(new Date).toISOString()})}).catch((e=>logger.error("Logger server error",e)))}}({enabled:!0,logEndpoint:"",logLevel:"error"}),"https://adgebra.co.in".split(",").map((e=>e.trim())).filter(Boolean),self.onmessage=function(r){const{type:s,data:o,taskId:n}=r.data;switch(s){case"processTemplate":const r=function(e){const t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":\'"\',"&#39;":"\'","&#x2F;":"/","&#x60;":"`","&#x3D;":"="};return e.replace(/&(?:#x[0-9a-f]+|#[0-9]+|[a-z0-9]+);/gi,(e=>{if(t[e])return t[e];if(e.startsWith("&#x")){const t=e.slice(3,-1);return String.fromCharCode(parseInt(t,16))}if(e.startsWith("&#")){const t=e.slice(2,-1);return String.fromCharCode(parseInt(t,10))}return e}))}(o.template);self.postMessage({type:"templateProcessed",data:r});break;case"processAdData":const s=(l=o.adData,__spreadProps(__spreadValues({},l),{ibnAds:l.ibnAds.map((e=>__spreadProps(__spreadValues({},e),{title:decodeURIComponent(e.title||"").replace(/\\+/g," "),trackerUrl:decodeURIComponent(e.trackerUrl||""),ctaMessage:e.ctaMessage?decodeURIComponent(e.ctaMessage).replace(/\\+/g," "):"",pnTitle:e.pnTitle?decodeURIComponent(e.pnTitle).replace(/\\+/g," "):""})))}));self.postMessage({type:"adDataProcessed",data:s});break;case"processBannerData":const i=__spreadProps(__spreadValues({},a=o),{banner:e(a.banner)});self.postMessage({type:"bannerDataProcessed",data:i});break;case"ABORT":self.postMessage({type:"ABORTED",data:t(n)})}var a,l}}();\n//# sourceMappingURL=ibnWorker-hUNYCnWR.js.map\n',E="undefined"!=typeof self&&self.Blob&&new Blob([I],{type:"text/javascript;charset=utf-8"});function C(e){let t;try{if(t=E&&(self.URL||self.webkitURL).createObjectURL(E),!t)throw"";const r=new Worker(t,{name:null==e?void 0:e.name});return r.addEventListener("error",(()=>{(self.URL||self.webkitURL).revokeObjectURL(t)})),r}catch(r){return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(I),{name:null==e?void 0:e.name})}finally{t&&(self.URL||self.webkitURL).revokeObjectURL(t)}}const P='var __async=(e,t,s)=>new Promise(((r,o)=>{var n=e=>{try{a(s.next(e))}catch(t){o(t)}},i=e=>{try{a(s.throw(e))}catch(t){o(t)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,i);a((s=s.apply(e,t)).next())}));!function(){"use strict";const e=new class{constructor({enabled:e=!1,logEndpoint:t="",logLevel:s="debug"}={}){this.enabled=e,this.logEndpoint=t,this.logLevel=s,this.levels=["debug","info","warn","error"],this.groupLevel=0}log(e,...t){if(!this.enabled)return;if(this.levels.indexOf(e)<this.levels.indexOf(this.logLevel))return;const s=(new Date).toISOString();console[e](`[${s}]`,...t),this.logEndpoint&&this.sendToServer(e,t)}debug(...e){this.log("debug",...e)}info(...e){this.log("info",...e)}warn(...e){this.log("warn",...e)}error(...e){this.log("error",...e)}metric(...e){this.log("warn",...e)}group(e=""){if(!this.enabled)return;if(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel))return;const t=(new Date).toISOString(),s="  ".repeat(this.groupLevel);console.group(`[${t}] ${s}${e}`),this.groupLevel++}groupEnd(){this.enabled&&(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel)||this.groupLevel>0&&(this.groupLevel--,console.groupEnd()))}sendToServer(e,t){fetch(this.logEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:t.join(" "),timestamp:(new Date).toISOString()})}).catch((e=>logger.error("Logger server error",e)))}}({enabled:!0,logEndpoint:"",logLevel:"error"}),t="https://adgebra.co.in".split(",").map((e=>e.trim())).filter(Boolean),s=new Map;self.addEventListener("message",(r=>__async(null,null,(function*(){var o;if(r.origin&&!t.includes(r.origin))return;if((null==(o=r.data)?void 0:o.source)&&!t.includes(r.data.source))return;const{method:n,url:i,params:a,body:l,requestId:u,requestType:d,isInitialRequest:c,taskId:g,type:h}=r.data;if("ABORT"===h){if(u&&s.has(u)){s.get(u).abort(),s.delete(u)}return void self.postMessage({type:"ABORTED",method:n,requestId:u,taskId:g,message:"Request was aborted",success:!1})}function p(e){return new Promise((t=>setTimeout(t,2e3*(e+1))))}const f=(t=0)=>__async(null,null,(function*(){const r=Date.now();let o,a;const g=new AbortController;u&&s.set(u,g);try{a="GET"===n?fetch(i,{signal:g.signal,credentials:"include"}):fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(l),signal:g.signal,credentials:"include"});const h=c?"10000":"1000",m=new Promise((e=>setTimeout((()=>e({timeoutOccurred:!0})),h))),v=yield Promise.race([a,m]);if(v.timeoutOccurred)return function(t,r,o,n,i,a,l){t.then((e=>__async(null,null,(function*(){if(!e.ok)throw new Error(`HTTP Error: ${e.status}`);const t=yield e.json();r&&s.delete(r),self.postMessage({method:i,data:t,requestId:r,requestType:a,responseTime:Date.now()-o,isInitialRequest:l,isLateResponse:!0,success:!0})})))).catch((t=>{r&&s.delete(r),"AbortError"!==t.name?(e.warn("Background fetch failed:",t),n<3&&setTimeout((()=>f(n+1)),2e3*(n+1))):e.info("Background fetch was aborted")}))}(a,u,r,t,n,d,c),c&&t<3?(yield p(t),f(t+1)):{data:{timeoutOccurred:!0},responseTime:Date.now()-r,isTimeout:!0};if(o=v,!o.ok)throw new Error(`HTTP Error: ${o.status}`);return{data:yield o.json(),responseTime:Date.now()-r,success:!0}}catch(h){if(u&&s.delete(u),"AbortError"===h.name)throw h;if(t<3)return e.warn(`Request failed, attempt ${t+1} of 3...`,h),yield p(t),f(t+1);throw h}}));try{const e=yield f();self.postMessage({method:n,data:e.data,requestId:u,requestType:d,responseTime:e.responseTime,isInitialRequest:c,success:!0,isTimeout:e.isTimeout||!1})}catch(m){self.postMessage({method:n,error:{message:m.message,name:m.name},requestId:u,requestType:d,isInitialRequest:c,success:!1}),"AbortError"===m.name&&self.postMessage({type:"ABORTED",method:n,requestId:u,taskId:g,message:"Request was aborted during execution",success:!1}),e.error("Request failed after all retries:",m)}}))))}();\n//# sourceMappingURL=networkWorker-CaLnJMGK.js.map\n',O="undefined"!=typeof self&&self.Blob&&new Blob([P],{type:"text/javascript;charset=utf-8"});function R(e){let t;try{if(t=O&&(self.URL||self.webkitURL).createObjectURL(O),!t)throw"";const r=new Worker(t,{name:null==e?void 0:e.name});return r.addEventListener("error",(()=>{(self.URL||self.webkitURL).revokeObjectURL(t)})),r}catch(r){return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(P),{name:null==e?void 0:e.name})}finally{t&&(self.URL||self.webkitURL).revokeObjectURL(t)}}const x='!function(){"use strict";function e(e){return{type:"ABORTED",message:"Task was aborted",taskId:e}}new class{constructor({enabled:e=!1,logEndpoint:t="",logLevel:s="debug"}={}){this.enabled=e,this.logEndpoint=t,this.logLevel=s,this.levels=["debug","info","warn","error"],this.groupLevel=0}log(e,...t){if(!this.enabled)return;if(this.levels.indexOf(e)<this.levels.indexOf(this.logLevel))return;const s=(new Date).toISOString();console[e](`[${s}]`,...t),this.logEndpoint&&this.sendToServer(e,t)}debug(...e){this.log("debug",...e)}info(...e){this.log("info",...e)}warn(...e){this.log("warn",...e)}error(...e){this.log("error",...e)}metric(...e){this.log("warn",...e)}group(e=""){if(!this.enabled)return;if(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel))return;const t=(new Date).toISOString(),s="  ".repeat(this.groupLevel);console.group(`[${t}] ${s}${e}`),this.groupLevel++}groupEnd(){this.enabled&&(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel)||this.groupLevel>0&&(this.groupLevel--,console.groupEnd()))}sendToServer(e,t){fetch(this.logEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:t.join(" "),timestamp:(new Date).toISOString()})}).catch((e=>logger.error("Logger server error",e)))}}({enabled:!0,logEndpoint:"",logLevel:"error"}),"https://adgebra.co.in".split(",").map((e=>e.trim())).filter(Boolean);const t=e=>e.map((([e,t])=>({name:e,timestamp:t,relativeTime:t-performance.timeOrigin}))),s=e=>e.map((([e,t])=>({name:e,duration:t.duration,startTime:t.startTime,endTime:t.endTime})));self.onmessage=r=>{const{type:o,data:i,taskId:n}=r.data;switch(o){case"process_metrics":try{const e=(a=i,{timestamp:Date.now(),metrics:{marks:t(a.marks),measures:s(a.measures),performance:a.performance}});self.postMessage({type:"metrics_processed",data:e})}catch(l){self.postMessage({type:"error",error:l.message})}break;case"ABORT":self.postMessage({type:"ABORTED",data:e(n)})}var a}}();\n//# sourceMappingURL=metricWorker-DRXwtJUD.js.map\n',M="undefined"!=typeof self&&self.Blob&&new Blob([x],{type:"text/javascript;charset=utf-8"});function L(e){let t;try{if(t=M&&(self.URL||self.webkitURL).createObjectURL(M),!t)throw"";const r=new Worker(t,{name:null==e?void 0:e.name});return r.addEventListener("error",(()=>{(self.URL||self.webkitURL).revokeObjectURL(t)})),r}catch(r){return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(x),{name:null==e?void 0:e.name})}finally{t&&(self.URL||self.webkitURL).revokeObjectURL(t)}}const S='var __async=(e,t,n)=>new Promise(((r,l)=>{var i=e=>{try{s(n.next(e))}catch(t){l(t)}},o=e=>{try{s(n.throw(e))}catch(t){l(t)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);s((n=n.apply(e,t)).next())}));!function(){"use strict";new class{constructor({enabled:e=!1,logEndpoint:t="",logLevel:n="debug"}={}){this.enabled=e,this.logEndpoint=t,this.logLevel=n,this.levels=["debug","info","warn","error"],this.groupLevel=0}log(e,...t){if(!this.enabled)return;if(this.levels.indexOf(e)<this.levels.indexOf(this.logLevel))return;const n=(new Date).toISOString();console[e](`[${n}]`,...t),this.logEndpoint&&this.sendToServer(e,t)}debug(...e){this.log("debug",...e)}info(...e){this.log("info",...e)}warn(...e){this.log("warn",...e)}error(...e){this.log("error",...e)}metric(...e){this.log("warn",...e)}group(e=""){if(!this.enabled)return;if(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel))return;const t=(new Date).toISOString(),n="  ".repeat(this.groupLevel);console.group(`[${t}] ${n}${e}`),this.groupLevel++}groupEnd(){this.enabled&&(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel)||this.groupLevel>0&&(this.groupLevel--,console.groupEnd()))}sendToServer(e,t){fetch(this.logEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:t.join(" "),timestamp:(new Date).toISOString()})}).catch((e=>logger.error("Logger server error",e)))}}({enabled:!0,logEndpoint:"",logLevel:"error"});const e="https://adgebra.co.in".split(",").map((e=>e.trim())).filter(Boolean),t="https://cdn.adgebra.net",n="https://adgebra.co.in/ocean/templateData";function r(e){return e.includes("nano")?\'<a href="#"><div class="nano_image"><img src="#" alt="ad"></div><div class="nano_text"></div></a>\':e.includes("ibn")?\'<!DOCTYPE html><html><head><style>body{margin:0;padding:0;}img{max-width:100%;height:auto;}</style></head><body><div class="ibn_content"></div></body></html>\':e.includes("ocean")?\'<div class="ad_container">\\x3c!-- ocean fallback --\\x3e</div>\':\'<div class="ad_container"></div>\'}self.addEventListener("message",(l=>__async(null,null,(function*(){var i;if(l.origin&&!e.includes(l.origin))return;if((null==(i=l.data)?void 0:i.source)&&!e.includes(l.data.source))return;const{type:o,data:s}=l.data;switch(o){case"loadTemplate":{const e=yield function(e){return __async(this,null,(function*(){var l;let i=`${t}/html/template/${e}.html`;try{let t=yield fetch(i);if(!t.ok){console.warn(`CDN fetch failed for ${e}, trying backend...`),i=`${n}?templateIds=${e}`;const t=yield fetch(i);if(!t.ok)throw new Error(`Backend fetch failed: ${t.status}`);const o=yield t.json();if(Array.isArray(o)&&o.length>0&&o[0].url){const e=null!=(l=o[0].header)?l:"";if(o[0].url.trim().startsWith("<"))return e+o[0].url.trim();if(o[0].url.trim().startsWith("http")){const t=yield fetch(o[0].url.trim());return e+(yield t.text())}}return console.warn(`No valid backend template for ${e}`),r(e)}return yield t.text()}catch(o){return console.error(`Error fetching template ${e}:`,o),r(e)}}))}(String(s.templateId).trim());self.postMessage({type:"loadTemplate",templateId:s.templateId,template:e});break}case"PROCESS_TEMPLATE":{const e=function(e,t){let n=e;return Object.entries(t).forEach((([e,t])=>{const r=new RegExp(`\\\\{\\\\{${e}\\\\}\\\\}`,"g");n=n.replace(r,t)})),n}(s.template,s.placeholders);self.postMessage({type:"TEMPLATE_PROCESSED",templateId:s.templateId,template:e});break}}}))))}();\n//# sourceMappingURL=templateWorker-rx-c5o3Q.js.map\n',A="undefined"!=typeof self&&self.Blob&&new Blob([S],{type:"text/javascript;charset=utf-8"});function q(e){let t;try{if(t=A&&(self.URL||self.webkitURL).createObjectURL(A),!t)throw"";const r=new Worker(t,{name:null==e?void 0:e.name});return r.addEventListener("error",(()=>{(self.URL||self.webkitURL).revokeObjectURL(t)})),r}catch(r){return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(S),{name:null==e?void 0:e.name})}finally{t&&(self.URL||self.webkitURL).revokeObjectURL(t)}}const N='var __async=(e,t,n)=>new Promise(((o,r)=>{var s=e=>{try{l(n.next(e))}catch(t){r(t)}},i=e=>{try{l(n.throw(e))}catch(t){r(t)}},l=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,i);l((n=n.apply(e,t)).next())}));!function(){"use strict";const e=new class{constructor({enabled:e=!1,logEndpoint:t="",logLevel:n="debug"}={}){this.enabled=e,this.logEndpoint=t,this.logLevel=n,this.levels=["debug","info","warn","error"],this.groupLevel=0}log(e,...t){if(!this.enabled)return;if(this.levels.indexOf(e)<this.levels.indexOf(this.logLevel))return;const n=(new Date).toISOString();console[e](`[${n}]`,...t),this.logEndpoint&&this.sendToServer(e,t)}debug(...e){this.log("debug",...e)}info(...e){this.log("info",...e)}warn(...e){this.log("warn",...e)}error(...e){this.log("error",...e)}metric(...e){this.log("warn",...e)}group(e=""){if(!this.enabled)return;if(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel))return;const t=(new Date).toISOString(),n="  ".repeat(this.groupLevel);console.group(`[${t}] ${n}${e}`),this.groupLevel++}groupEnd(){this.enabled&&(this.levels.indexOf("debug")<this.levels.indexOf(this.logLevel)||this.groupLevel>0&&(this.groupLevel--,console.groupEnd()))}sendToServer(e,t){fetch(this.logEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:t.join(" "),timestamp:(new Date).toISOString()})}).catch((e=>logger.error("Logger server error",e)))}}({enabled:!0,logEndpoint:"",logLevel:"error"});"https://adgebra.co.in".split(",").map((e=>e.trim())).filter(Boolean);class t{oceanArticleGet(t){return __async(this,null,(function*(){const n=`https://adgebra.co.in/ocean/articles?url=${encodeURIComponent(t)}`;try{const t=yield fetch(n),o=yield t.json();return e.info("GET response:",o),o}catch(o){e.error("GET error:",o)}}))}oceanArticlePost(){return __async(this,null,(function*(){try{const t=yield fetch("https://qabrand.inuxu.net/ocean/articles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.generatePayload())}),n=yield t.json();return e.info("POST response:",n),n}catch(t){e.error("POST error:",t)}}))}generatePayload(){return{url:"demo.inuxu.org"}}}self.onmessage=e=>__async(null,null,(function*(){const{action:n,hostname:o}=e.data;if("fetchArticles"===n){const e=new t;try{const t=yield e.oceanArticleGet(o);postMessage(t.oceanArticles||[])}catch(r){postMessage([])}}}))}();\n//# sourceMappingURL=oceanArticleWorker-D0NpYp8l.js.map\n',U="undefined"!=typeof self&&self.Blob&&new Blob([N],{type:"text/javascript;charset=utf-8"});function $(e){let t;try{if(t=U&&(self.URL||self.webkitURL).createObjectURL(U),!t)throw"";const r=new Worker(t,{name:null==e?void 0:e.name});return r.addEventListener("error",(()=>{(self.URL||self.webkitURL).revokeObjectURL(t)})),r}catch(r){return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(N),{name:null==e?void 0:e.name})}finally{t&&(self.URL||self.webkitURL).revokeObjectURL(t)}}const D={ibn:1,network:function(e=6,t=4){const r=navigator.hardwareConcurrency||t,s=navigator.deviceMemory&&navigator.deviceMemory<2;return/Mobi/i.test(navigator.userAgent)||s?Math.min(2,r):Math.min(e,r)}(6,4),ocean:2,metric:1,template:1,oceanArticle:2},j="ibn",B="network",W="ocean",z="metric",F="template",H="ocean_article";class G{constructor(){this.pools=new Map,this.initializePools(),this.executeTask=this.executeTask.bind(this)}initializePools(){this.pools.set(j,new w(C,D.ibn)),this.pools.set(B,new w(R,D.network)),this.pools.set(W,new w(T,D.ocean)),this.pools.set(z,new w(L,D.metric)),this.pools.set(F,new w(q,D.template)),this.pools.set(H,new w($,D.oceanArticle))}executeTask(e,t,r){return __async(this,null,(function*(){const s=this.pools.get(e);if(!s)throw new Error(`No pool found for type: ${e}`);return s.executeTask(t,r)}))}terminateAll(){this.pools.forEach((e=>e.terminate())),this.pools.clear()}terminate(e){this.pools.get(e).terminate(),this.pools.delete(e)}}e=new WeakMap;const V=new G,K=new class{constructor({onReport:t=l.info,enabled:r=!0,batchSize:s=10,bufferSize:n=1e3}={},i){__privateAdd(this,e,[]),this.enabled=r,this.batchSize=s,this.onReport=t,this.isProcessing=!1,this.flushInterval=6e4,this.buffers={timestamps:new Float64Array(n),durations:new Float64Array(n),types:new Uint8Array(n)},this.marks=new Map,this.measures=new Map,this.pendingBatch=[],this.typeRegistry=new Map,this.nextTypeId=1,this.currentIndex=0,this.initWorkerManager(i),this.enabled&&this.init(),l.info("Metrics collector initialized",{enabled:this.enabled,batchSize:this.batchSize,bufferSize:n})}initWorkerManager(e){return __async(this,null,(function*(){try{if(!e)throw new Error("Invalid worker manager");this.workerManager=e,yield this.initializeWorker()}catch(t){l.error("Failed to initialize worker manager:",t),this.workerManager=null}}))}initializeWorker(){return __async(this,null,(function*(){this.workerManager}))}report(){return __async(this,null,(function*(){if(!this.enabled)return;l.info("Manual report triggered");const e={marks:Array.from(this.marks.entries()),measures:Array.from(this.measures.entries()),performance:{timestamps:Array.from(this.buffers.timestamps.slice(0,this.currentIndex)),durations:Array.from(this.buffers.durations.slice(0,this.currentIndex)),types:Array.from(this.buffers.types.slice(0,this.currentIndex)),typeRegistry:Array.from(this.typeRegistry.entries())}};if(this.workerManager)try{const t=yield this.workerManager.executeTask(z,{type:"process_metrics",data:e});this.onReport(t)}catch(t){l.error("Metrics worker error:",t),this.onReport(e)}else this.onReport(e);this.resetMetrics()}))}flush(){return __async(this,null,(function*(){if(!this.enabled||0===this.currentIndex)return;const e={marks:Array.from(this.marks.entries()),measures:Array.from(this.measures.entries()),performance:{timestamps:Array.from(this.buffers.timestamps.slice(0,this.currentIndex)),durations:Array.from(this.buffers.durations.slice(0,this.currentIndex)),types:Array.from(this.buffers.types.slice(0,this.currentIndex)),typeRegistry:Array.from(this.typeRegistry.entries())}};if(this.workerManager)try{yield this.workerManager.executeTask(z,{type:"process_metrics",data:e})}catch(t){l.error("Metrics worker error during flush:",t)}this.resetMetrics()}))}destroy(){this.flushInterval&&clearInterval(this.flushInterval),this.flush().then((()=>{this.clearAll(),this.enabled=!1,this.workerManager&&(this.workerManager.terminate(z),this.workerManager=null),this.marks=null,this.measures=null,this.pendingBatch=null,this.typeRegistry=null,this.assetTrackers=null}))}init(){this.enabled&&(this.clearAll(),this.setupPeriodicFlush(),this.setupPerformanceObserver(),this.mark("metrics-collector-init"))}setupPerformanceObserver(){const e=new PerformanceObserver((e=>{e.getEntries().forEach((e=>{this.queueMetric("navigation",{type:e.entryType,duration:e.duration,startTime:e.startTime,name:e.name})}))})),t=new PerformanceObserver((e=>{e.getEntries().forEach((e=>{this.queueMetric("resource",{type:e.initiatorType,duration:e.duration,startTime:e.startTime,name:e.name})}))})),r=new PerformanceObserver((e=>{e.getEntries().forEach((e=>{this.queueMetric("long-task",{duration:e.duration,startTime:e.startTime})}))}));try{e.observe({entryTypes:["navigation"]}),t.observe({entryTypes:["resource"]}),r.observe({entryTypes:["longtask"]})}catch(s){l.warn("PerformanceObserver not fully supported:",s)}}setupPeriodicFlush(){this.flushInterval=setInterval((()=>{this.flush()}),this.flushInterval)}mark(e){if(!this.enabled)return;const t=performance.now();this.marks.set(e,t);try{performance.mark(e)}catch(r){l.warn("Failed to create performance mark:",r)}this.queueMetric("mark",{name:e,timestamp:t}),l.info(`Mark created: ${e}`,t)}measure(e,t,r){if(!this.enabled)return;const s=this.marks.get(t),n=r?this.marks.get(r):performance.now();if(!s)return void l.warn(`Start mark "${t}" not found for measure "${e}"`);const i=n-s;this.measures.set(e,{duration:i,startTime:s,endTime:n});try{performance.measure(e,t,r)}catch(a){l.warn(`Failed to create performance measure: ${a.message}`)}return this.queueMetric("measure",{name:e,duration:i,startMark:t,endMark:r}),l.debug(`Measure created: ${e}`,{duration:i,startTime:s,endTime:n}),i}trackAsset(e,t="unknown"){if(!this.enabled)return this.createNoopTracker();const r={startTime:0,assetId:e,assetType:t,start:()=>{r.startTime=performance.now(),this.mark(`${e}-start`),this.queueMetric("asset-start",{id:e,type:t,timestamp:r.startTime})},end:()=>{const s=performance.now()-r.startTime;this.mark(`${e}-end`),this.measure(`${e}-load`,`${e}-start`,`${e}-end`),this.queueMetric("asset-complete",{id:e,type:t,duration:s})},error:s=>{const n=performance.now();this.mark(`${e}-error`),this.measure(`${e}-error`,`${e}-start`,`${e}-error`),this.queueMetric("asset-error",{id:e,type:t,duration:n-r.startTime,error:s.message})}};return this.assetTrackers.set(e,r),r}trackActivity(e){if(!this.enabled)return this.createNoopTracker();const t=performance.now(),r=`${e}-activity-start`,s=`${e}-activity-end`;return this.mark(r),{end:()=>{this.mark(s);const n=this.measure(e,r,s);this.queueMetric("activity",{name:e,duration:n,startTime:t}),this.clearMarks(r),this.clearMarks(s)}}}queueMetric(e,t){if(!this.enabled)return;const r=this.getMetricObject();r.timestamp=performance.now(),r.type=e,r.data=t,this.pendingBatch.push(r),this.pendingBatch.length>=this.batchSize&&this.processBatch()}processBatch(){this.isProcessing||0===this.pendingBatch.length||(this.isProcessing=!0,requestAnimationFrame((()=>{this.processMetricsWithDeadline()})))}processMetricsWithDeadline(){try{const e=performance.now()+16;for(;this.pendingBatch.length>0&&performance.now()<e;){const e=this.pendingBatch.shift();this.storeMetric(e),this.releaseMetricObject(e)}}finally{this.isProcessing=!1,this.pendingBatch.length>0&&this.processBatch()}}storeMetric(e){const t=this.currentIndex%this.buffers.timestamps.length;this.buffers.timestamps[t]=e.timestamp,this.buffers.durations[t]=e.data.duration||0,this.buffers.types[t]=this.getTypeIndex(e.type),this.currentIndex++,this.currentIndex>=this.buffers.timestamps.length&&this.flush()}clearAll(){this.clearMarks(),this.clearMeasures(),this.resetMetrics()}clearMarks(e){e?(this.marks.delete(e),performance.clearMarks(e)):(this.marks.clear(),performance.clearMarks())}clearMeasures(e){e?(this.measures.delete(e),performance.clearMeasures(e)):(this.measures.clear(),performance.clearMeasures())}resetMetrics(){this.currentIndex=0,this.pendingBatch=[],this.isProcessing=!1}getTypeIndex(e){return this.typeRegistry.has(e)||this.typeRegistry.set(e,this.nextTypeId++),this.typeRegistry.get(e)}createNoopTracker(){return{start:()=>{},end:()=>{},error:()=>{}}}getMetricObject(){return __privateGet(this,e).pop()||{}}releaseMetricObject(t){__privateGet(this,e).length<1e3&&__privateGet(this,e).push(t)}}({enabled:"false",batchSize:10,onReport:e=>{l.metric("Metrics Report:",e)}},V);class Q{constructor(e,t=null,r=null){this.config=e,this.network=t,this.name=r}load(){return __async(this,null,(function*(){var e;const t=K.trackActivity("ad_loader_"+this.name),r=this.handler.getElements(),s=this.handler.getRequestMethod(),n=this.handler.getEndpoint(),i=this.handler.buildRequestPayload();if(null===i)return null==l||l.warn(`Payload is empty for ${this.handler.getName()}.`),"failed";try{const{data:t,fromCache:a}="POST"===s?yield this.network.post(n,i,this.name):yield this.network.get(n,i,this.name);return!t||t.error?"failed":(a&&(null==l||l.info("Response served from cache due to timeout")),null==(e=this.parser)||e.parse(t,r),"success")}catch(a){return null==l||l.error(`Ad loading failed for handler ${this.handler.getName()}`,a),"failed"}finally{t.end()}}))}setHandler(e){this.handler=e}setParser(e){this.parser=e}setNetwork(e){this.network=e}setConfig(e){this.config=e}}class J{constructor(e,t,r,s=!0,n=!1,i=console){this.filter=e,this.classFilter=s,this.endpoint=t,this.name=r,this.config={},this.viewability=n,this.logger=i}generateRequestParams(){throw new Error("Must implement generateRequestParams() in subclass")}buildRequestPayload(){throw new Error("buildRequestPayload() must be implemented")}getQueryString(){const e=this.generateRequestParams();return e?(t=e,Object.entries(t).map((([e,t])=>`&${e}=${encodeURIComponent(null!=t?t:"")}`)).join("")):null;var t}enableViewability(e,t){if(this.viewability){this.logger.log(`Viewability of ${this.name}`);const r=t.impressionUrlForApi;if(!r)return;new IntersectionObserver(((e,t)=>{e.forEach((e=>{e.isIntersecting&&(fetch(r,{method:"GET"}).catch(logger.error),t.unobserve(e.target))}))}),{threshold:.5}).observe(e)}}setConfig(e){this.config=e}getRequestMethod(){return"GET"}getName(){return this.name}getElements(){if(this.elements)return this.elements;try{const e=this.classFilter?[...document.querySelectorAll(`.${CSS.escape(this.filter)}`)]:[],t=document.getElementById(this.filter);this.elements=e.length?e:t?[t]:[]}catch(e){logger.error("Error occurred while fetching elements:",e),this.elements=[]}return this.elements}getEndpoint(){return this.endpoint}shouldHandleScroll(){return!1}handleElement(e){throw new Error("handleElement() must be implemented by subclass")}processElements(){this.getElements().forEach((e=>this.handleElement(e)))}}class X extends J{constructor(e){super("adg_native_ibn","https://adgebra.co.in/afpf/data/loadAdServingData-v2","IBN"),this.ibnConfig=e,this.ibn=[]}handleElement(e){l.info("Processing NanoHandler:",e)}generateRequestParams(){var e;const t=this.getElements(),{keywords:r,data_domain:s}=this.ibnConfig;let n=(null==(e=t[0])?void 0:e.getAttribute("data-pubid"))||"0";return Array.from(t).map((e=>{if(e.hasAttribute("data-processed"))return;const t=parseInt(e.getAttribute("data-slot")||e.getAttribute("data-slotId")||"1",10),r=parseInt(e.getAttribute("data-templateId")||e.getAttribute("data-templateid"),10);return e.setAttribute("data-processed","true"),this.ibn.push({slotId:t,templateId:r}),{slotId:t,templateId:r}})),{partnerId:n,siteUrl:s,timestamp:d(),refererURL:h(),metaKeywords:r||"",ibn:this.ibn}}getRequestMethod(){return"POST"}buildRequestPayload(){return this.generateRequestParams()}}class Y{parse(e,t){return __async(this,null,(function*(){}))}destroy(){}}let Z=!1;function ee(e,t){if(l.info("deviceId--\x3e",e),Z||!t)return;const r=document.querySelector(".adg_native_ibn, #adg_native_ocean, .adg_native_nano");if(!r||r.hasAttribute("data-read-more-attached"))return;const s=function(e,t){const r="2"===e?"D":"M",s=t[`readMoreParent${r}ClassName`];if("generic"!==s){const e=document.getElementsByClassName(s);if(e.length>0)return e[0]}const n=t[`readMoreParent${r}TagName`];if("generic"!==n){const e=document.getElementsByTagName(n);if(e.length>0)return e[0]}const i=t[`readMoreParent${r}IdName`];if("generic"!==i)return document.getElementById(i);return null}(e,t);s?(!function(e,t,r){const s="2"==t?"D":"M",n=r[`readMore${s}ParameterHeight`],i=r[`readMoreParent${s}DivCss`],a=r[`readMoreParent${s}ButtonCss`],o=r.readMoreLanguageContent||"Read More",l=document.createElement("div");l.innerHTML=`<button class="adgebra_expand-btn">${o}</button>`,e.insertAdjacentElement("afterbegin",l),e.style.overflow="hidden",e.style.height=n+"px",l.setAttribute("style",i),l.style.zIndex=r.zIndex||10,l.style.marginTop=n-200+"px";const c=l.querySelector(".adgebra_expand-btn");c.setAttribute("style",a),c.onclick=()=>{e.style.overflow="visible",e.style.height="auto",l.remove(),Z=!0}}(s,e,t),r.setAttribute("data-read-more-attached","true")):function(e,t){if(t.consoleMessageFlag<1)return;const r="2"===e?"D":"M",s=(e,t)=>{"generic"!==t&&l.info(`Adgebra Read More: Defined ${e} not found - ${t}`)};s("class name",t[`readMoreParent${r}ClassName`]),s("tag name",t[`readMoreParent${r}TagName`]),s("ID",t[`readMoreParent${r}IdName`])}(e,t)}function te(e){return new URLSearchParams(e)}class re extends Y{constructor(e,t,r){super(),__publicField(this,"parse",((e,t,r)=>__async(this,null,(function*(){try{l.info("IBNParser:",e.ibn.adgResponse);const r=e.ibn.adgResponse;if(this.currentResponse=e,!this.validateIbnResponse(r,t))return;yield this.processIBNAds(r,t),this.siteId=(null==e?void 0:e.siteId)||0,this.isIBNLoaded=!0,this.destroy()}catch(r){l.error("Exception in parse ibn response :",r)}})))),__publicField(this,"processIBNAds",((e,t)=>__async(this,null,(function*(){const r=t.map((t=>__async(this,null,(function*(){var r;try{const s=t.getAttribute("data-templateId")||t.getAttribute("data-templateid"),n=t.getAttribute("data-slot")||t.getAttribute("data-slotId");if(!s||!n)return;const i=e[`${s}_${n}`];if(this.addThirdPartyTrackers(i,t),!i)return;const a=this.processAdData(i);if(0===(null==(r=a.ibnAds)?void 0:r.length))return;const o=this.templateCache.get(s);yield this.renderAdInDiv(t,a,o)}catch(s){l.error("Error processing ad:",s)}}))));yield Promise.all(r)})))),this.workerManager=e,this.ibnConfig=t,this.pendingCallbacks=new Map,this.currentResponse={},this.templateCache=r,this.siteId=0}sendWorkerMessage(e,t){return __async(this,null,(function*(){try{const r=yield this.workerManager.executeTask(j,{type:e,data:t,timestamp:Date.now()});if(r.error)throw new Error(r.error);return r.data}catch(r){throw l.error(`Worker task failed for type ${e}:`,r),r}}))}createMainIframe(e,t,r,s,n){return __async(this,null,(function*(){return new Promise((i=>{__async(null,null,(function*(){try{const a=function(e){const t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/","&#x60;":"`","&#x3D;":"="};return e.replace(/&(?:#x[0-9a-f]+|#[0-9]+|[a-z0-9]+);/gi,(e=>{if(t[e])return t[e];if(e.startsWith("&#x")){const t=e.slice(3,-1);return String.fromCharCode(parseInt(t,16))}if(e.startsWith("&#")){const t=e.slice(2,-1);return String.fromCharCode(parseInt(t,10))}return e}))}(t),o=document.createElement("iframe");o.id="adg_native_home_iframe",1==n?(o.style.width="100%",o.style.height=`${s}px`):(r&&(o.style.width=`${r}px`),s&&(o.style.height=`${s}px`)),o.style.border="none",o.style.overflow="hidden",o.style.position="relative",o.style.display="block",o.setAttribute("scrolling","no"),o.setAttribute("frameborder","0"),o.setAttribute("allowtransparency","true"),o.srcdoc=a,o.onload=()=>{i(o)},e.appendChild(o)}catch(a){l.error("Error creating main iframe:",a),i(null)}}))}))}))}validateIbnResponse(e,t){try{return e&&0!==Object.keys(e).length?!!(null==t?void 0:t.length)||(l.warn("No elements provided for rendering"),!1):(l.warn("Empty or missing IBN response"),!1)}catch(r){return l.error("Error validating IBN input:",r),!1}}processAdData(e){const t=e=>{if(!e)return"";try{return decodeURIComponent(e).replace(/\+/g," ")}catch(t){return console.warn("decodeURIComponent failed for:",e,t),e}};return __spreadProps(__spreadValues({},e),{ibnAds:Array.isArray(null==e?void 0:e.ibnAds)?e.ibnAds.map((e=>__spreadProps(__spreadValues({},e),{title:t(null==e?void 0:e.title),trackerUrl:t(null==e?void 0:e.trackerUrl),ctaMessage:t(null==e?void 0:e.ctaMessage),pnTitle:t(null==e?void 0:e.pnTitle)}))):[]})}buildPayload(e){const t=h(),r=parseInt(e.getAttribute("data-pubid")||"0"),s=e.getAttribute("data-templateId"),{data_domain:n}=this.ibnConfig;return{pubId:r,templateId:s,domain:n,productType:3,refererUrl:t}}renderAdInDiv(e,t,r){return __async(this,null,(function*(){var s,n,i;let a=t.ibnAds[0].templateSize;const o=null==(s=this.currentResponse)?void 0:s.deviceId;try{let s,d;if("string"==typeof a){const[e,t]=a.toLowerCase().split("x").map(Number);isNaN(e)||(s=e),isNaN(t)||(d=t)}const h=yield this.createMainIframe(e,r,s,d,o),m=h.contentDocument||h.contentWindow.document,g=m.getElementsByClassName("adg_native_home"),f=t.ibnAds;if(g&&f&&(yield Promise.all(f.map(((e,t)=>__async(this,null,(function*(){const r=g[t];r&&(this.setContainerVisibility(r),e.banner?yield this.renderBannerAd(r,e,t,m):yield this.renderContentAd(r,e,m))}))))),this.updateIframeHeight(h,m,d),this.setupMutationObserver(g),l.info("currentResponse--\x3e",this.currentResponse),null==(n=this.currentResponse)?void 0:n.siteParametersJson)){const e=null==(i=this.currentResponse)?void 0:i.siteParametersJson;try{ee(o,JSON.parse(e))}catch(c){l.warn("ReadMore: Failed to parse siteParameter",c)}}const y=this.buildPayload(e);!function(e){__async(this,arguments,(function*({pubId:e,templateId:t,domain:r,productType:s,refererUrl:n,uniqueId:i}){try{const a=te({pubId:e,templateId:t,domain:r,productType:s,refererUrl:n,uniqueId:i});navigator.sendBeacon?(navigator.sendBeacon(u,a),l.debug("Widget impression POST sent via sendBeacon",a.toString())):fetch(u,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a}).then((e=>l.debug("Widget impression POST via fetch",e))).catch((e=>l.error("Fetch POST error",e)))}catch(c){l.error("Error in fireWidgetImpression",c)}}))}(y),function(e,t){__async(this,arguments,(function*({pubId:e,templateId:t,domain:r,productType:s,refererUrl:n,uniqueId:i},a){a&&"undefined"!=typeof IntersectionObserver?new IntersectionObserver(((a,o)=>{a.forEach((a=>{if(a.isIntersecting){try{const a=te({pubId:e,templateId:t,domain:r,productType:s,refererUrl:n,uniqueId:i});navigator.sendBeacon?(navigator.sendBeacon(p,a),l.debug("Viewable impression POST sent via sendBeacon",a.toString())):fetch(p,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a}).then((e=>l.debug("Viewable impression POST via fetch",e))).catch((e=>l.error("Fetch POST error",e)))}catch(c){l.error("Error in fireViewableImpression",c)}o.unobserve(a.target)}}))}),{threshold:.25}).observe(a):l.warn("IntersectionObserver not supported")}))}(y,e)}catch(d){l.error("Error rendering ad:",d)}}))}setContainerVisibility(e){e.style.display="block",e.style.setProperty("display","block","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important")}renderBannerAd(e,t,r,s){return __async(this,null,(function*(){try{if(!e||!t)return;const n=yield this.sendWorkerMessage("processBannerData",t),i=this.createBannerIframe(r,s);e.innerHTML="",e.appendChild(i);const a=i.contentWindow.document;a.open(),a.write(this.getBannerTemplate(n.banner)),a.close(),this.setupTrackingPixels(e,t,s)}catch(n){l.error("Error rendering banner ad:",n)}}))}createBannerIframe(e,t){const r=t.createElement("iframe");return Object.assign(r,{id:`nativeAdcodeBanner${e}`,frameBorder:"0",scrolling:"no"}),Object.assign(r.style,{width:"100%",border:"none",position:"relative",zIndex:"2"}),r}getBannerTemplate(e){return`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <style>\n                    body { margin: 0; padding: 0; }\n                    img { max-width: 100%; height: auto; }\n                </style>\n            </head>\n            <body>\n                ${e}\n            </body>\n            </html>\n        `}renderContentAd(e,t,r){return __async(this,null,(function*(){try{if(!e||!t)return;const s=e.querySelector("a");s&&(this.updateMainLink(s,t),yield this.updateMainImage(s,t)),this.updateHeading(e,t),yield this.updateBrandInfo(e,t,r),this.addCtaButton(e,t,r),e.style.display="block"}catch(s){l.error("Error rendering content ad:",s)}}))}updateMainLink(e,t){e.href=t.trackerUrl,e.target="_blank",e.rel="nofollow"}updateMainImage(e,t){return __async(this,null,(function*(){const r=e.querySelector(".adg_Native_Img");if(r){r.style.visibility="hidden";const e=yield this.getImageUrl(r.alt,t);e&&(r.src=e,r.loading="lazy",r.decoding="async",r.onload=()=>{r.style.visibility="visible"},r.onerror=()=>{r.src="https://cdn.adgebra.net/custom/generic/native_loding_icon.jpg",l.warn("Image failed to load:",imageSrc.src)},r.removeAttribute("alt"),r.removeAttribute("title"))}}))}getImageUrl(e,t){return __async(this,null,(function*(){const r=function(e,t){return t[{adg_Native_HD_Img:"img990x505",adg_43_200x150:"size_43_200x150",adg_43_100x75:"size_43_100x75",adg_169_400x225:"size_169_400x225",adg_169_200x113:"size_169_200x113",adg_169_100x56:"size_169_100x56",adg_21_400x200:"size_21_400x200",adg_21_200x100:"size_21_200x100",adg_21_100x50:"size_21_100x50",adg_65_600x500:"size_65_600x500",adg_65_300x250:"size_65_300x250",adg_65_100x83:"size_65_100x83"}[e]]||t.imageUrl}(e,t);return r||null}))}updateIframeHeight(e,t,r){e.style.height=`${r}px`}setupMutationObserver(e){const t=new MutationObserver(this.handleMutations.bind(this));Array.from(e).forEach((e=>{t.observe(e,{attributes:!0,attributeFilter:["style"]})}))}destroy(){this.pendingCallbacks.clear(),this.worker&&(this.worker.terminate(),this.worker=null)}updateHeading(e,t){try{const r=e.querySelector(".adg_Native_Img_heading");r&&t.title&&(r.textContent=t.title)}catch(r){l.error("Error updating heading:",r)}}updateBrandInfo(e,t,r){return __async(this,null,(function*(){try{const s=e.querySelector(".ad_icon_img"),n=e.querySelector(".ad_icon_text");n&&(n.textContent=(null==t?void 0:t.pnTilte)||"Brand"),s&&t.iconImageUrl&&(yield this.updateBrandIcon(s,t,r))}catch(s){l.error("Error updating brand info:",s)}}))}updateBrandIcon(e,t,r){return __async(this,null,(function*(){try{const s=r.createElement("img");s.src=t.iconImageUrl,s.alt="Brand Icon",s.style.visibility="hidden",s.decoding="async",s.onload=()=>{s.style.visibility="visible"},s.onerror=()=>{s.src="fallback-image-url"},e.innerHTML="",e.appendChild(s)}catch(s){l.error("Error updating brand icon:",s),e.style.display="none"}}))}addCtaButton(e,t,r){try{const s=e.querySelector(".ctaDiv");if(s&&t.ctaMessage){const e=r.createElement("button");e.type="button",e.className="ctaButton",e.textContent=t.ctaMessage,s.appendChild(e)}}catch(s){l.error("Error adding CTA button:",s)}}getActualHeight(e){try{const t=e.body,r=e.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,r.clientHeight,r.scrollHeight,r.offsetHeight)}catch(t){return l.error("Error calculating height:",t),250}}handleMutations(e){e.forEach((e=>{if("attributes"===e.type&&"style"===e.attributeName){const t=e.target;!t.classList.contains("adg_native_home")||"none"!==t.style.display&&t.style.display||t.style.setProperty("display","block","important")}}))}buildTrackerUrl(e){let t=decodeURIComponent(e.trackerUrl);const r=self===top?{isIframe:!1,referUrl:""}:{isIframe:!0,referUrl:window.location!==window.parent.location?document.referrer:document.location.href};return 1===Number(r.isIframe)&&(t+=`&isIframe=${r.isIframe}&referurl=${r.referurl}`),t}addTrackingDiv(e,t){const r=t.impTPTracker;Array.isArray(r)&&r.length&&r.forEach(((t,r)=>{const s=document.createElement("div");s.style.display="none","string"==typeof t&&(/^https?:\/\//.test(t)?s.innerHTML=`<img src="${t}" style="display:none;" />`:s.innerHTML=t,e.appendChild(s))}))}addThirdPartyTrackers(e,t){return __async(this,null,(function*(){try{if(!Array.isArray(null==e?void 0:e.ibnAds)||0===e.ibnAds.length)return;e.ibnAds.forEach((e=>{e&&this.addTrackingDiv(t,e)}))}catch(r){l.error("Exception in third party trackers :",r)}}))}}class se{static injectStyles(){if(this.injected)return;const e=document.createElement("style");e.id="adg-ocean-custom-shimmer-styles",e.textContent="\n   /* Base Grid Container */\n  .adg-ocean-shimmer-grid {\n    display: grid;\n    gap: 20px;\n    padding: 15px;\n    max-width: 1200px;\n    margin: 0 auto;\n  }\n\n  /* Shared Shimmer Styles */\n  .adg-ocean-shimmer-card {\n    background: #f6f7f8;\n    border-radius: 8px;\n    position: relative;\n    overflow: hidden;\n    display: flex;\n    padding: 15px;\n  }\n\n  /* Enhanced Shimmer Animation */\n  .adg-ocean-shimmer-card::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(\n      90deg,\n      rgba(255,255,255,0) 0%,\n      rgba(255,255,255,0.3) 20%,\n      rgba(255,255,255,0.7) 50%,\n      rgba(255,255,255,0.3) 80%,\n      rgba(255,255,255,0) 100%\n    );\n    animation: adg-ocean-shimmer 2.5s infinite ease-in-out;\n    transform: translateX(-100%);\n  }\n\n  /* Image Placeholder */\n  .adg-ocean-shimmer-img {\n    width: 120px;\n    height: 120px;\n    background: #e1e3e5;\n    border-radius: 4px;\n    margin-right: 15px;\n    flex-shrink: 0;\n    position: relative;\n    overflow: hidden;\n  }\n  \n  .adg-ocean-shimmer-img::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(\n      90deg,\n      rgba(255,255,255,0) 0%,\n      rgba(255,255,255,0.6) 50%,\n      rgba(255,255,255,0) 100%\n    );\n    animation: adg-ocean-shimmer 2.5s infinite 0.3s ease-in-out;\n    transform: translateX(-100%);\n  }\n\n  /* Content Placeholders */\n  .adg-ocean-shimmer-content {\n    flex: 1;\n  }\n  \n  .adg-ocean-shimmer-line {\n    height: 12px;\n    background: #e1e3e5;\n    margin-bottom: 10px;\n    border-radius: 4px;\n    position: relative;\n    overflow: hidden;\n  }\n  \n  .adg-ocean-shimmer-line::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(\n      90deg,\n      rgba(255,255,255,0) 0%,\n      rgba(255,255,255,0.6) 50%,\n      rgba(255,255,255,0) 100%\n    );\n    animation: adg-ocean-shimmer 2.5s infinite 0.5s ease-in-out;\n    transform: translateX(-100%);\n  }\n  \n  .adg-ocean-shimmer-line.short {\n    width: 60%;\n  }\n  \n  .adg-ocean-shimmer-line.medium {\n    width: 80%;\n  }\n  \n  .adg-ocean-shimmer-line.long {\n    width: 90%;\n  }\n  \n  .adg-ocean-shimmer-line.title {\n    height: 20px;\n    margin-bottom: 15px;\n    width: 70%;\n  }\n  \n  .adg-ocean-shimmer-line.button {\n    height: 30px;\n    width: 100px;\n    border-radius: 20px;\n    margin-top: 15px;\n  }\n\n  @keyframes adg-ocean-shimmer {\n    0% { transform: translateX(-100%); }\n    60% { transform: translateX(100%); }\n    100% { transform: translateX(100%); }\n  }\n\n  /* Mobile Optimization */\n  @media (max-width: 768px) {\n    .adg-ocean-shimmer-card {\n      flex-direction: column;\n    }\n    \n    .adg-ocean-shimmer-img {\n      width: 100%;\n      height: 100px;\n      margin-right: 0;\n      margin-bottom: 15px;\n    }\n  }\n    ",document.head.appendChild(e),this.injected=!0}static buildSkeletonHTML(e=3){let t="";for(let r=0;r<e;r++)t+='\n  <div class="adg-ocean-shimmer-card">\n    <div class="adg-ocean-shimmer-img"></div>\n    <div class="adg-ocean-shimmer-content">\n      <div class="adg-ocean-shimmer-line title"></div>\n      <div class="adg-ocean-shimmer-line medium"></div>\n      <div class="adg-ocean-shimmer-line short"></div>\n      <div class="adg-ocean-shimmer-line long"></div>\n      <div class="adg-ocean-shimmer-line button"></div>\n    </div>\n  </div>\n      ';return`<div class="adg-ocean-shimmer-grid">${t}</div>`}static show(e,{cards:t=1,className:r="",style:s="",timeout:n=0}={}){if(!e)return;this.injectStyles(),this.remove(e);const i=document.createElement("div");if(i.className=`adg-ocean-shimmer-container ${r}`.trim(),s&&("string"==typeof s?i.style.cssText=s:"object"==typeof s&&Object.assign(i.style,s)),i.innerHTML=this.buildSkeletonHTML(t),e.appendChild(i),n>0){const t=setTimeout((()=>{this.remove(e)}),n);this.timeouts.set(e,t)}}static observe(e,{cards:t=1,className:r="",style:s="",timeout:n=0}={}){if(!e)return;this.unobserve(e);const i=new IntersectionObserver((i=>{i.forEach((i=>{i.isIntersecting&&this.show(e,{cards:t,className:r,style:s,timeout:n})}))}),{threshold:.1});i.observe(e),this.observers.set(e,i)}static unobserve(e){if(!e)return;const t=this.timeouts.get(e);t&&(clearTimeout(t),this.timeouts.delete(e));const r=this.observers.get(e);r&&(r.unobserve(e),r.disconnect(),this.observers.delete(e))}static remove(e){if(!e)return;const t=e.querySelector(".adg-ocean-shimmer-container");t&&t.remove()}static cleanup(){this.timeouts.forEach(((e,t)=>{clearTimeout(e)})),this.timeouts=new WeakMap,this.observers.forEach(((e,t)=>{e.unobserve(t),e.disconnect()})),this.observers=new WeakMap;const e=document.getElementById("custom-shimmer-styles");e&&e.remove(),this.injected=!1}}__publicField(se,"injected",!1),__publicField(se,"observers",new WeakMap),__publicField(se,"timeouts",new WeakMap);class ne extends Y{constructor(e){super(),__publicField(this,"parse",((e,t)=>__async(this,null,(function*(){l.info("TpPixelParser:",e),this.validateTpPixelResponse(e,t)?(yield this.processThirdPartyPixel(t,e),t.forEach((e=>se.remove(e))),this.isTpPixelLoaded=!0,this.destroy()):t.forEach((e=>se.remove(e)))})))),this.viewabilityManager=e,this.isTpPixelLoaded=!1,this.setupPageUnloadCleanup()}validateTpPixelResponse(e,t){try{return e?!!(null==t?void 0:t.length)||(l.warn("No elements provided for rendering"),!1):(l.warn("Missing ocean.adgResponse in input"),!1)}catch(r){return l.error("Error validating input:",r),!1}}processThirdPartyPixel(e,t){return __async(this,null,(function*(){for(const r of e)yield this.renderTpInElement(r,t)}))}renderTpInElement(e,t){return __async(this,null,(function*(){if(t&&e)try{const n=document.createElement("div");n.innerHTML=t;const i=document.createElement("div");for(const e of Array.from(n.childNodes))"SCRIPT"!==e.tagName&&i.appendChild(e.cloneNode(!0));if(n.querySelectorAll("script").forEach((e=>{const t=document.createElement("script");for(const r of e.attributes)t.setAttribute(r.name,r.value);e.textContent&&(t.textContent=e.textContent),i.appendChild(t)})),"IFRAME"===e.tagName)try{const t=e.contentDocument||e.contentWindow.document;t.open(),t.write("<!DOCTYPE html><html><head></head><body></body></html>"),t.close(),t.body.appendChild(i),l.info("Third Party pixel injected into iframe successfully.")}catch(r){l.error("Failed to inject pixel into iframe (likely cross-origin):",r);try{e.srcdoc=t,l.info("Pixel injected using iframe.srcdoc fallback.")}catch(s){l.error("Failed to use iframe.srcdoc as fallback:",s)}}else e.appendChild(i),l.info("Third Party pixel injected into element successfully.")}catch(n){l.error("Failed to inject Third Party pixel into element:",n)}}))}destroy(){this.pageCleanup(),window.removeEventListener("beforeunload",this.beforeUnloadHandler),window.removeEventListener("popstate",this.beforeUnloadHandler)}setupPageUnloadCleanup(){var e;this.beforeUnloadHandler=()=>{this.pageCleanup()},window.addEventListener("beforeunload",this.beforeUnloadHandler),"function"==typeof(null==(e=null==window?void 0:window.history)?void 0:e.pushState)&&window.addEventListener("popstate",this.beforeUnloadHandler)}pageCleanup(){try{this.viewabilityManager&&this.viewabilityManager.destroy(),l.debug("Page cleanup completed")}catch(e){l.error("Error during page cleanup:",e)}}}const ie=4,ae=3,oe=2,le=1,ce=0,de="network",he={CRITICAL:4,HIGH:3,NORMAL:2,LOW:1,IDLE:0},ue={NETWORK:"network",GENERAL:"general"};class pe{constructor(e={}){this.options=__spreadValues({defaultTimeSlice:5,yieldInterval:13,maxTasksPerBatch:20,idleTimeout:2e3,networkTimeout:15e3,networkConcurrency:4,enableAutoDetection:!0,enableAdaptation:!0,enableMonitoring:!0,monitoringInterval:5e3,jankThreshold:50},e),this.queues={[he.CRITICAL]:[],[he.HIGH]:[],[he.NORMAL]:[],[he.LOW]:[],[he.IDLE]:[]},this.activeNetworkRequests=0,this.networkQueue=[],this.abortControllers=new Map,this.isProcessing=!1,this.isPaused=!1,this.isAdapting=!1,this.lastAdaptationTime=0,this.metrics={tasksScheduled:0,tasksCompleted:0,tasksAborted:0,timeSpentProcessing:0,networkRequests:0,networkSuccess:0,networkErrors:0,networkTimeouts:0,frameTimes:[],jankCount:0,adaptationCount:0},this.options.enableAutoDetection&&this.detectCapabilities(),this.processTasks=this.processTasks.bind(this),this.processTasksWithDeadline=this.processTasksWithDeadline.bind(this),this.processLowPriorityTasks=this.processLowPriorityTasks.bind(this),this.adaptToConditions=this.adaptToConditions.bind(this),this.processNetworkQueue=this.processNetworkQueue.bind(this),this.setupIdleProcessing(),this.options.enableMonitoring&&this.setupPerformanceMonitoring(),this.startNetworkProcessor(),l.info("Task Scheduler initialized with options:",this.options)}detectCapabilities(){this.deviceCapabilities={cores:navigator.hardwareConcurrency||4,lowMemory:navigator.deviceMemory&&navigator.deviceMemory<=4,connection:this.detectNetworkCondition(),hasBattery:"getBattery"in navigator},this.deviceCapabilities.hasBattery&&this.setupBatteryMonitoring();(this.deviceCapabilities.cores<=2||this.deviceCapabilities.lowMemory||"slow"===this.deviceCapabilities.connection.type)&&(this.options.defaultTimeSlice=3,this.options.maxTasksPerBatch=10,this.options.networkConcurrency=2,this.options.yieldInterval=8,this.isLowEndDevice=!0,l.info("Task Scheduler: Low-end device detected, adjusting parameters")),l.info("Device capabilities detected:",this.deviceCapabilities)}detectNetworkCondition(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{};let t="medium",r=5,s=100,n=!1;if(e.effectiveType){switch(e.effectiveType){case"slow-2g":case"2g":t="very-slow";break;case"3g":t="slow";break;case"4g":t="medium";break;default:t="fast"}e.downlink&&(r=e.downlink),e.rtt&&(s=e.rtt),e.saveData&&(n=e.saveData),e.addEventListener("change",(()=>{this.deviceCapabilities.connection=this.detectNetworkCondition(),this.adaptToConditions(!0)}))}else if(performance&&performance.navigation){const e=performance.getEntriesByType("navigation")[0];if(e){const r=e.loadEventEnd-e.fetchStart;t=r>5e3?"slow":r>2e3?"medium":"fast"}}return{type:t,downlink:r,rtt:s,saveData:n}}setupBatteryMonitoring(){return __async(this,null,(function*(){try{const e=yield navigator.getBattery();this.deviceCapabilities.battery={level:e.level,charging:e.charging,lowPower:e.level<=.15&&!e.charging},e.addEventListener("levelchange",(()=>{this.deviceCapabilities.battery.level=e.level,this.deviceCapabilities.battery.lowPower=e.level<=.15&&!e.charging,this.deviceCapabilities.battery.level<=.05&&!e.charging&&this.adaptToConditions(!0)})),e.addEventListener("chargingchange",(()=>{this.deviceCapabilities.battery.charging=e.charging,this.deviceCapabilities.battery.lowPower=e.level<=.15&&!e.charging,this.adaptToConditions()}))}catch(e){l.warn("Battery API access failed:",e),this.deviceCapabilities.hasBattery=!1}}))}setupPerformanceMonitoring(){let e=performance.now(),t=0;const r=()=>{const s=performance.now(),n=s-e;e=s,this.metrics.frameTimes.push(n),this.metrics.frameTimes.length>60&&this.metrics.frameTimes.shift(),n>this.options.jankThreshold?(this.metrics.jankCount++,t++,t>=3&&this.options.enableAdaptation&&(this.adaptToConditions(!0),t=0)):t=0,this.isDestroyed||requestAnimationFrame(r)};if(requestAnimationFrame(r),this.options.enableAdaptation&&(this.adaptationInterval=setInterval(this.adaptToConditions,this.options.monitoringInterval)),"PerformanceObserver"in window)try{const e=new PerformanceObserver((e=>{for(const t of e.getEntries())this.metrics.jankCount++,t.duration>100&&this.options.enableAdaptation&&this.adaptToConditions(!0)}));e.observe({entryTypes:["longtask"]}),this.longTaskObserver=e}catch(s){l.warn("Long task observation not supported:",s)}}adaptToConditions(e=!1){const t=performance.now();if((e||!(t-this.lastAdaptationTime<this.options.monitoringInterval/2))&&!this.isAdapting){this.isAdapting=!0,this.lastAdaptationTime=t,this.metrics.adaptationCount++;try{const e=this.metrics.frameTimes.length>0?this.metrics.frameTimes.reduce(((e,t)=>e+t),0)/this.metrics.frameTimes.length:16,t=this.metrics.networkRequests>0?this.metrics.networkSuccess/this.metrics.networkRequests:1,r="very-slow"===this.deviceCapabilities.connection.type||"slow"===this.deviceCapabilities.connection.type||t<.7,s=e>20||this.metrics.jankCount>10&&this.metrics.frameTimes.length>30||this.isLowEndDevice,n=this.deviceCapabilities.battery&&this.deviceCapabilities.battery.lowPower;let i=__spreadValues({},this.options);r&&(i.networkConcurrency=Math.max(1,this.options.networkConcurrency-1),i.networkTimeout=1.5*this.options.networkTimeout,l.info("Adapting for poor network conditions",{networkSuccessRate:t,connection:this.deviceCapabilities.connection})),s&&(i.defaultTimeSlice=Math.max(2,this.options.defaultTimeSlice-1),i.maxTasksPerBatch=Math.max(5,this.options.maxTasksPerBatch-5),i.yieldInterval=Math.max(5,this.options.yieldInterval-2),l.info("Adapting for poor device performance",{avgFrameTime:e,jankCount:this.metrics.jankCount})),n&&(i.defaultTimeSlice=Math.max(1,i.defaultTimeSlice-1),i.maxTasksPerBatch=Math.max(3,i.maxTasksPerBatch-3),i.networkConcurrency=Math.max(1,i.networkConcurrency-1),l.info("Adapting for low battery",{batteryLevel:this.deviceCapabilities.battery.level})),this.options=i}finally{this.isAdapting=!1}}}setupIdleProcessing(){"requestIdleCallback"in window?(this.hasIdleCallback=!0,this.requestIdleProcessing()):(this.hasIdleCallback=!1,this.idleFallbackInterval=setInterval((()=>{!this.isProcessing&&this.queues[he.IDLE].length>0&&this.processIdleTasksWithTimeout()}),1e3))}requestIdleProcessing(){this.idleCallbackId=requestIdleCallback(this.processLowPriorityTasks,{timeout:this.options.idleTimeout})}processLowPriorityTasks(e){const t=this.queues[he.IDLE];for(;t.length>0&&(e.timeRemaining()>1||e.didTimeout);){const r=t.shift();if(this.executeTask(r),e.timeRemaining()<=1&&!e.didTimeout)break}this.isDestroyed||this.requestIdleProcessing()}processIdleTasksWithTimeout(){const e=this.queues[he.IDLE],t=performance.now(),r=Math.min(e.length,5);for(let s=0;s<r&&!(performance.now()-t>50);s++){const t=e.shift();this.executeTask(t)}}scheduleTask(e,t={}){const{priority:r=he.NORMAL,type:s=ue.GENERAL,timeSlice:n=this.options.defaultTimeSlice,isAsync:i=!1,name:a=`task_${this.metrics.tasksScheduled}`,timeout:o=(s===ue.NETWORK?this.options.networkTimeout:10*n),signal:l=null}=t;return s===ue.NETWORK?this.scheduleNetworkTask(e,{priority:r,name:a,timeout:o,signal:l}):new Promise(((t,c)=>{const d={fn:e,priority:r,type:s,timeSlice:n,isAsync:i,name:a,timeout:o,signal:l,resolve:t,reject:c,scheduled:performance.now(),attempts:0};if(l&&l.aborted){const e=new Error("Task was aborted");return e.name="AbortError",void c(e)}l&&l.addEventListener("abort",(()=>{const e=this.queues[r],t=e.findIndex((e=>e===d));if(-1!==t){e.splice(t,1);const r=new Error("Task was aborted");r.name="AbortError",c(r)}})),this.queues[r].push(d),this.metrics.tasksScheduled++,this.isProcessing||this.isPaused||this.startProcessing()}))}scheduleNetworkTask(e,t){const{priority:r=he.NORMAL,name:s=`network_${this.metrics.networkRequests}`,timeout:n=this.options.networkTimeout,signal:i=null}=t;return this.metrics.networkRequests++,new Promise(((t,a)=>{let o,l;i?l=i:(o=new AbortController,l=o.signal);const c={fn:e,priority:r,name:s,resolve:t,reject:a,scheduled:performance.now(),timeout:n,signal:l,abortController:o};o&&this.abortControllers.set(c,o),this.networkQueue.push(c),this.networkQueue.sort(((e,t)=>t.priority-e.priority)),this.processNetworkQueue()}))}startNetworkProcessor(){this.networkInterval=setInterval((()=>{this.checkNetworkTimeouts(),this.processNetworkQueue()}),1e3)}processNetworkQueue(){if(!(this.activeNetworkRequests>=this.options.networkConcurrency||0===this.networkQueue.length||this.isPaused))for(;this.activeNetworkRequests<this.options.networkConcurrency&&this.networkQueue.length>0;){const e=this.networkQueue.shift();if(e.signal&&e.signal.aborted){const t=new Error("Network request was aborted");t.name="AbortError",e.reject(t)}else this.executeNetworkTask(e)}}executeNetworkTask(e){return __async(this,null,(function*(){this.activeNetworkRequests++;const t="number"==typeof e.timeout&&e.timeout>0?e.timeout:this.options.networkTimeout,r=setTimeout((()=>{e.abortController&&e.abortController.abort(),this.metrics.networkTimeouts++,this.activeNetworkRequests--;const r=new Error(`Network request timed out after ${t}ms`);r.name="TimeoutError",e.reject(r),this.abortControllers.delete(e),this.processNetworkQueue()}),t);try{const t=yield e.fn(e.signal);clearTimeout(r),this.activeNetworkRequests--,this.metrics.networkSuccess++,e.resolve(t),this.abortControllers.delete(e),this.processNetworkQueue()}catch(s){clearTimeout(r),this.activeNetworkRequests--,"AbortError"!==s.name&&this.metrics.networkErrors++,e.reject(s),this.abortControllers.delete(e),this.processNetworkQueue()}}))}checkNetworkTimeouts(){const e=performance.now();for(let t=this.networkQueue.length-1;t>=0;t--){const r=this.networkQueue[t];if(e-r.scheduled>r.timeout){this.networkQueue.splice(t,1),this.metrics.networkTimeouts++;const e=new Error(`Network request timed out while waiting in queue (${r.timeout}ms)`);e.name="QueueTimeoutError",r.reject(e),this.abortControllers.delete(r)}}}startProcessing(){this.isProcessing||this.isPaused||(this.isProcessing=!0,requestAnimationFrame(this.processTasks))}processTasks(){if(this.isPaused||this.isDestroyed)return void(this.isProcessing=!1);if(![he.CRITICAL,he.HIGH,he.NORMAL,he.LOW].some((e=>this.queues[e].length>0)))return void(this.isProcessing=!1);const e=performance.now();this.processTasksWithDeadline(e+this.options.yieldInterval),[he.CRITICAL,he.HIGH,he.NORMAL,he.LOW].some((e=>this.queues[e].length>0))?setTimeout((()=>{this.isDestroyed||requestAnimationFrame(this.processTasks)}),0):this.isProcessing=!1}processTasksWithDeadline(e){let t=0;for(let r=he.CRITICAL;r>=he.LOW;r--){const s=this.queues[r];for(;s.length>0&&performance.now()<e&&t<this.options.maxTasksPerBatch;){const r=s.shift();if(this.executeTask(r),t++,performance.now()>=e)break}if(performance.now()>=e)break}}executeTask(e){return __async(this,null,(function*(){const t=performance.now();if(e.attempts++,e.signal&&e.signal.aborted){const t=new Error("Task was aborted");return t.name="AbortError",void e.reject(t)}try{let t;if(e.isAsync)try{const r=new Promise(((t,r)=>{const s=setTimeout((()=>{const t=new Error(`Task timed out after ${e.timeout}ms`);t.name="TaskTimeoutError",r(t)}),e.timeout);e.timeoutId=s}));t=yield Promise.race([e.fn(),r]),e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=null),e.resolve(t),this.metrics.tasksCompleted++}catch(r){e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=null),"TaskTimeoutError"===r.name?(l.warn(`Task ${e.name} timed out after ${e.timeout}ms, ${e.attempts} attempts`),e.priority>he.LOW&&e.attempts<3?this.rescheduleTask(e):(e.reject(r),this.metrics.tasksAborted++)):(e.reject(r),this.metrics.tasksAborted++)}else{const s=performance.now(),n=e.timeSlice;try{t=e.fn();const r=performance.now()-s;r>this.options.longTaskThreshold&&l.warn(`Long task detected: ${e.name} took ${r.toFixed(2)}ms (slice: ${n}ms)`),e.resolve(t),this.metrics.tasksCompleted++}catch(r){l.error(`Task ${e.name} failed:`,r),e.reject(r),this.metrics.tasksAborted++}}}catch(r){l.error(`Error executing task ${e.name}:`,r),e.reject(r),this.metrics.tasksAborted++}finally{const e=performance.now()-t;this.metrics.timeSpentProcessing+=e}}))}rescheduleTask(e){e.priority>he.IDLE&&e.priority--,e.timeout*=1.5,this.queues[e.priority].push(e)}pause(){this.isPaused=!0}resume(){this.isPaused&&(this.isPaused=!1,this.processNetworkQueue(),[he.CRITICAL,he.HIGH,he.NORMAL,he.LOW].some((e=>this.queues[e].length>0))&&this.startProcessing())}abortAllNetworkRequests(){for(const[t,r]of this.abortControllers.entries())try{r.abort()}catch(e){l.error("Error aborting request:",e)}this.abortControllers.clear(),this.networkQueue=[],this.activeNetworkRequests=0}getMetrics(){const e={};Object.entries(this.queues).forEach((([t,r])=>{e[`priority${t}Length`]=r.length}));const t=this.metrics.frameTimes.length>0?this.metrics.frameTimes.reduce(((e,t)=>e+t),0)/this.metrics.frameTimes.length:0,r={networkQueueLength:this.networkQueue.length,activeNetworkRequests:this.activeNetworkRequests,networkSuccessRate:this.metrics.networkRequests>0?this.metrics.networkSuccess/this.metrics.networkRequests:1};return __spreadProps(__spreadValues(__spreadValues(__spreadValues({},this.metrics),e),r),{averageFrameTime:t,isProcessing:this.isProcessing,isPaused:this.isPaused,deviceInfo:this.deviceCapabilities})}destroy(){this.isDestroyed=!0,this.pause(),this.abortAllNetworkRequests(),Object.keys(this.queues).forEach((e=>{this.queues[e]=[]})),this.hasIdleCallback&&this.idleCallbackId&&cancelIdleCallback(this.idleCallbackId),this.networkInterval&&clearInterval(this.networkInterval),this.idleFallbackInterval&&clearInterval(this.idleFallbackInterval),this.adaptationInterval&&clearInterval(this.adaptationInterval),this.longTaskObserver&&this.longTaskObserver.disconnect(),l.info("Task Scheduler destroyed",this.getMetrics())}}const me=new class{getElements(){if(this.elementMap&&this.elementMap.size>0)return this.elementMap;const e=this._fetchElementKeys();this.elementMap=new Map;try{e&&e.size>0&&e.forEach(((e,t)=>{if(e.key)try{const r=this._fetchElements(e.classFilter,e.key);this.elementMap.set(t,r)}catch(r){l.error(`Error querying for class ${e.key}:`,r),this.elementMap.set(e.key,[])}}))}catch(t){l.error("Error occurred while fetching elements:",t),this.elementMap=new Map}return this.elementMap}getTemplateIdByProduct(e){const t=this.getElements().get(e);return t&&t.length>0?t[0].templateId:null}getElementByProductId(e){const t=this.getElements().get(e);return t&&t.length>0?t:null}_fetchElements(e,t){const r=e?[...document.querySelectorAll(`.${CSS.escape(t)}`)]:[],s=document.getElementById(t);let n;return r.length&&(n=r),n=s?[s]:[],n.map((e=>({element:e,tagName:e.tagName,id:e.id,className:e.className,templateId:this._fetchTemplateId(e)||"",slotId:this._fetchSlotId(e)||""})))}_fetchElementKeys(){const e=JSON.parse('{"ocean": {"key":"adg_native_ocean", "classFilter": false},"ocean1": {"key":"adg_ocean_main_div", "classFilter": false}, "ibn":{"key":"adg_native_ibn", "classFilter": true}, "nano":{"key":"adg_native_nano", "classFilter": true}}');return l.info("template data is: "),l.info(e),new Map(Object.entries(e))}_fetchTemplateId(e){const t=e.getAttribute("data-templateId"),r=e.getAttribute("data-templateId_slotId");return e&&t?t:e&&r?r.split("_")[0]:null}_fetchSlotId(e){const t=e.getAttribute("data-slotId"),r=e.getAttribute("data-templateId_slotId");return e&&t?t:e&&r&&r.split("_").length>1?r.split("_")[1]:null}};const ge=new class{constructor(e={}){this.templates=new Map,this.loadingPromises=new Map,this.config=__spreadValues({useCDN:!0,enableLocalCache:!0,preloadTemplates:!0,templateCacheTTL:864e5},e),this.cdnBasePath="https://cdn.adgebra.net",this.initialized=!1,this.initPromise=null,this.commonTemplateIds=["nano-default","ibn-default","ocean-default"]}init(){return this.initialized?Promise.resolve():(null!==this.initPromise||(this.placeholderElementMap=me.getElements(),this.templateIds=this._fetchTemplateIds(this.placeholderElementMap),this.initPromise=this._initialize()),this.initPromise)}getTemplate(e,t){const r=this.placeholderElementMap.get(e);if(r&&r.length>0){const e=r.find((t=>t.templateId===e));return this.loadTemplate(e)}return Promise.resolve("")}_initialize(){return __async(this,null,(function*(){try{this.config.enableLocalCache&&this._loadCachedTemplates(),this.config.preloadTemplates&&this._preloadCommonTemplates(),this.initialized=!0,l.info("Template Manager initialized")}catch(e){l.error("Failed to initialize Template Manager:",e)}}))}_loadCachedTemplates(){try{const e=localStorage.getItem("adg_templates");if(e){const t=JSON.parse(e);t.timestamp&&Date.now()-t.timestamp<this.config.templateCacheTTL?(Object.entries(t.templates).forEach((([e,t])=>{this.templates.set(e,t)})),l.info(`Loaded ${this.templates.size} templates from cache`)):localStorage.removeItem("adg_templates")}}catch(e){l.warn("Failed to load cached templates:",e)}}_preloadCommonTemplates(){this.templateIds.forEach((e=>{this.loadTemplate(e,!0)}))}_saveTemplatesToCache(){if(this.config.enableLocalCache)try{const e={};this.templates.forEach(((t,r)=>{e[r]=t}));const t={timestamp:Date.now(),templates:e};localStorage.setItem("adg_templates",JSON.stringify(t))}catch(e){l.warn("Failed to save templates to cache:",e)}}loadTemplate(e,t=!1){return __async(this,null,(function*(){if(this.templates.has(e))return this.templates.get(e);if(this.loadingPromises.has(e))return this.loadingPromises.get(e);const r=this._fetchTemplate(e,t);this.loadingPromises.set(e,r);try{const t=yield r;return this.templates.set(e,t),this._saveTemplatesToCache(),t}finally{this.loadingPromises.delete(e)}}))}_fetchTemplate(e,t=!1){const r=t?le:oe;let s=this._getTemplateUrl(e);return(new pe).scheduleTask((()=>__async(this,null,(function*(){var t;try{s=this._getTemplateUrlFromBackend(e);const r=yield fetch(s);if(!r.ok)throw new Error(`Failed to fetch template from backend: ${r.status}`);const n=yield r.json();if(Array.isArray(n)&&n.length>0&&n[0].url){const e=null!=(t=n[0].header)?t:"";return(e+n[0].url).trim()}return l.warn(`No valid template data received for templateId ${e}`),this._getFallbackTemplate(e)}catch(r){return l.info(`Error fetching template ${e}:`,r),this._getFallbackTemplate(e)}}))),r,de)}_getTemplateUrl(e){return this.config.useCDN?`${this.cdnBasePath}/html/template/${e}.html`:`/templates/${e}.html`}_getTemplateUrlFromBackend(e){const t=Array.isArray(e)?e.join(","):e;l.info("ids--\x3e",t);const r=`https://adgebra.co.in/ocean/templateData?templateIds=${t}`;return l.info("Generated Backend URL --\x3e",r),r}_getFallbackTemplate(e){return e.includes("nano")?'<a href="#">\n        <div class="nano_image">\n            <img src="#" alt="adg_43_400x300">\n        </div>\n        <div class="nano_text"></div>\n      </a>':e.includes("ibn")?'\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <style>\n                body { margin: 0; padding: 0; }\n                img { max-width: 100%; height: auto; }\n            </style>\n        </head>\n        <body>\n            <div class="ibn_content"></div>\n        </body>\n        </html>\n      ':'<div class="ad_container"></div>'}getSkeletonTemplate(e){return e.includes("nano")?'<div class="skeleton-loading">\n        <div class="skeleton-image"></div>\n        <div class="skeleton-text">\n          <div class="skeleton-line"></div>\n          <div class="skeleton-line"></div>\n        </div>\n      </div>':e.includes("ocean")?'<div class="skeleton-loading">\n        <div class="skeleton-header"></div>\n        <div class="skeleton-image"></div>\n        <div class="skeleton-text">\n          <div class="skeleton-line"></div>\n          <div class="skeleton-line"></div>\n          <div class="skeleton-line"></div>\n        </div>\n      </div>':'<div class="skeleton-loading">\n      <div class="skeleton-image"></div>\n      <div class="skeleton-text"></div>\n    </div>'}clearCache(){this.templates.clear(),this.config.enableLocalCache&&localStorage.removeItem("adg_templates")}_fetchTemplateIds(e){if(0===e.size)return[];const t=Array.from(e.values()).flatMap((e=>e.filter((e=>e.templateId&&""!==e.templateId.trim())).map((e=>e.templateId+".html"))));return new Set([...this.commonTemplateIds,...t])}};const fe=Object.freeze(Object.defineProperty({__proto__:null,IBNLoader:class extends Q{constructor(e,t,r){super(e,t,"IBN"),this.workerManager=r,this.ibnConfig=e,this.shimmerConfig={enableShimmer:!1,shimmerTimeout:5e3,shimmerExtraClassNames:"",shimmerStyle:"height: auto"},this.setupPageUnloadCleanup(),this.templateCache=new Map,this.init(e)}init(e){return __async(this,null,(function*(){const e=K.trackActivity("ibn_ads_processing");try{yield Promise.all([this.initHandler(),this.templateCollection()]),this.ibnParser=new re(this.workerManager,this.ibnConfig,this.templateCache),this.tpPixelParser=new ne(null),this.setParser(this.ibnParser),yield this.loadAd()}catch(t){throw l.error("Error in IBN loader:",t),t}finally{e.end()}}))}initHandler(){this.ibnHandler=new X(this.ibnConfig),this.ibnHandler.setConfig(this.ibnConfig),this.setHandler(this.ibnHandler)}templateCollection(){return __async(this,null,(function*(){try{const e=[...new Set(this.ibnHandler.getElements().map((e=>e.getAttribute("data-templateId"))).filter(Boolean))];l.debug("Collected template IDs:",e),yield Promise.all(e.map((e=>__async(this,null,(function*(){if(!this.templateCache.has(e))try{const t=yield ge.loadTemplate(e);this.templateCache.set(e,(null==t?void 0:t.trim())||""),l.debug(`Cached templateId=${e}, length=${null==t?void 0:t.length}`)}catch(t){l.error(`Failed to load templateId=${e}:`,t)}})))))}catch(e){l.error("Error in templateCollection:",e)}}))}loadAd(){return __async(this,null,(function*(){var e,t,r,s;const n=K.trackActivity("ad_loader_"+this.name),i=this.handler.getElements();if(this.shimmerConfig.enableShimmer&&i.forEach((e=>{se.show(e,{cards:2,timeout:this.shimmerConfig.shimmerTimeout})})),!Array.isArray(i)||0===i.length)return;const a=this.handler.getRequestMethod(),o=this.handler.getEndpoint(),c=this.handler.buildRequestPayload();if(null===c)return null==l||l.warn(`Payload is empty for ${this.handler.getName()}.`),"failed";try{const{data:n,fromCache:d}="POST"===a?yield this.network.post(o,c,this.name):yield this.network.get(o,c,this.name);if(!n||n.error)return i.forEach((e=>se.remove(e))),"failed";{d&&(null==l||l.info("Response served from cache due to timeout"));const a=null==(e=null==n?void 0:n.ibn)?void 0:e.tpPixel;if(this.isTpPixelResponse(a))return null==(t=this.tpPixelParser)||t.parse(a,i),i.forEach((e=>se.remove(e))),this.shimmerConfig.enableShimmer&&i.forEach((e=>{se.remove(e)})),"success";if(null==(r=null==n?void 0:n.ibn)?void 0:r.adgResponse)return null==(s=this.ibnParser)||s.parse(n,i),i.forEach((e=>se.remove(e))),this.shimmerConfig.enableShimmer&&i.forEach((e=>{se.remove(e)})),"success"}}catch(d){return null==l||l.error(`Ad loading failed for handler ${this.handler.getName()}`,d),i.forEach((e=>se.remove(e))),"failed"}finally{n.end()}}))}isTpPixelResponse(e){return!!e&&("object"==typeof e?Object.keys(e).length>0:Array.isArray(e)?e.length>0:"string"==typeof e&&""!==e.trim())}firePreFetchTrackers(){return __async(this,null,(function*(){this.ibnHandler.getElements().forEach((e=>{!function(e){__async(this,arguments,(function*({pubId:e,templateId:t,domain:r,productType:s,refererUrl:n,uniqueId:i}){try{const a=te({pubId:e,templateId:t,domain:r,productType:s,refererUrl:n,uniqueId:i});navigator.sendBeacon?(navigator.sendBeacon(m,a),l.debug("Prefetch impression POST sent via sendBeacon",a.toString())):fetch(u,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a}).then((e=>l.debug("Widget impression POST via fetch",e))).catch((e=>l.error("Fetch POST error",e)))}catch(a){l.error("Error in fire Pre-fetch Impression",a)}}))}(this.buildPayload(e))}))}))}buildPayload(e){const t=h(),r=parseInt(e.getAttribute("data-pubid")||"0"),s=e.getAttribute("data-templateId"),{data_domain:n}=this.ibnConfig;return{pubId:r,templateId:s,domain:n,productType:3,refererUrl:t,uniqueId:this.uniqueId}}setupPageUnloadCleanup(){window.addEventListener("beforeunload",(()=>{this.templateCache.clear()}))}}},Symbol.toStringTag,{value:"Module"})),ye=class e{constructor(){if(__privateAdd(this,n),__privateAdd(this,r,null),__privateAdd(this,s,null),__privateGet(e,t))throw new Error("Use PageMetaExtractor.initialize() for initialization")}static initialize(){return __async(this,null,(function*(){var r;return __privateGet(e,t)||(__privateSet(e,t,new e),yield __privateMethod(r=__privateGet(e,t),n,a).call(r)),__privateGet(e,t)}))}static getInstance(){if(!__privateGet(e,t))throw new Error("PageMetaExtractor not initialized. Call initialize() first");return __privateGet(e,t)}getFirstWords(e=50){return __async(this,null,(function*(){return __privateGet(this,r)||(yield __privateMethod(this,n,a).call(this)),new Promise((t=>{const{title:s,keywords:n,description:i,content:a}=__privateGet(this,r);requestIdleCallback((()=>{const r=`${s} ${n} ${i} ${a}`.replace(/\s+/g," ").trim().split(" ").slice(0,e).join(" ");t(r)}),{timeout:1e3})}))}))}getData(){return __privateGet(this,r)?__spreadValues({},__privateGet(this,r)):null}static reset(){__privateSet(e,t,null)}};t=new WeakMap,r=new WeakMap,s=new WeakMap,n=new WeakSet,i=function(){return new Promise((e=>{requestIdleCallback((()=>{const t=document.body.cloneNode(!0);t.querySelectorAll("script, style, noscript").forEach((e=>e.remove()));const r=t.textContent||"";e(r.trim())}),{timeout:1e3})}))},a=function(){return __async(this,null,(function*(){return __privateGet(this,s)||__privateSet(this,s,(()=>__async(this,null,(function*(){try{const[e,t]=yield Promise.all([__privateMethod(this,n,i).call(this),__privateMethod(this,n,o).call(this)]);return __privateSet(this,r,__spreadProps(__spreadValues({url:location.href,title:document.title||""},t),{content:e})),__privateGet(this,r)}catch(e){throw logger.error("Error extracting page meta data:",e),__privateSet(this,r,{url:location.href,title:"",keywords:"",description:"",content:""}),e}finally{__privateSet(this,s,null)}})))()),__privateGet(this,s)}))},o=function(){return __async(this,null,(function*(){return new Promise((e=>{requestAnimationFrame((()=>{const t=document.querySelector('meta[name="keywords"]'),r=document.querySelector('meta[name="description"]');e({keywords:t?t.getAttribute("content"):"",description:r?r.getAttribute("content"):""})}))}))}))},__privateAdd(ye,t,null);let be=ye;const ve=Object.freeze(Object.defineProperty({__proto__:null,extractPageKeywords:function(e=50,t=5e3){return __async(this,null,(function*(){const r=new AbortController;let s;try{const n=(yield be.initialize()).getFirstWords(e),i=new Promise(((e,n)=>{s=setTimeout((()=>{r.abort(),n(new Error("Keyword extraction timeout"))}),t)})),a=(yield Promise.race([n,i]))||"";return l.info("Keywords extracted successfully:",a),a}catch(n){return l.error("Error extracting keywords:",n),""}finally{clearTimeout(s),r.abort()}}))}},Symbol.toStringTag,{value:"Module"})),we=new pe;class _e{constructor(e){this.workerManager=e,this.firstRequestTracker=new Map,this.requestCounter=0,this.requestCounterMap=new Map,this.REQUEST_TIMEOUT=5e3,this.MAX_CACHE_SIZE=5,this.debug=!0,this.messageListeners=new Map,this.setupLateResponseHandler()}setupLateResponseHandler(){var e,t;if(!(null==(t=null==(e=this.workerManager)?void 0:e.pools)?void 0:t.get(B)))return;this.workerManager.pools.get(B).workers.forEach((e=>{const t=this.messageListeners.get(e);t&&e.removeEventListener("message",t);const r=e=>{const t=e.data;t.isLateResponse&&this.handleLateResponse(t)};e.addEventListener("message",r),this.messageListeners.set(e,r)}))}handleLateResponse(e){const{requestId:t,data:r,requestType:s}=e;if(!c.hasInCache(s)||!r)return;const n=this.generateWriteCacheKey(s);n&&(c.addToCache(s,n,r),this.debug&&(l.group(`Late Response Handled #${t}`),l.info("Request Type:",s),l.info("Cache Key:",n),l.info("Cache Updated with Late Response"),l.groupEnd()))}get(e,t){return __async(this,arguments,(function*(e,t,r=null,s={}){const{priority:n="normal",timeout:i=15e4,signal:a=null,headers:o={},requestType:l=r}=s,c=this.mapStringToPriority(n),d=t?`${e}?${t}`:e;return this.scheduleNetworkRequest("GET",d,null,o,c,i,a,l)}))}post(e,t){return __async(this,arguments,(function*(e,t,r=null,s={}){const{priority:n="normal",timeout:i=15e3,signal:a=null,headers:o={},requestType:l=r}=s,c=this.mapStringToPriority(n);return this.scheduleNetworkRequest("POST",e,t,o,c,i,a,l)}))}getLatestFromCache(e){if(!c.hasInCache(e))return null;const t=this.generateReadCacheKey(e);return t?c.getFromCache(e,t):null}handleErrorResponse(e,t,r,s){if(s)throw e;const n=this.getLatestFromCache(t);if(n)return{data:n,fromCache:!0,requestId:r,error:e};throw e}handleTimeoutResponse(e,t){if(!c.hasInCache(e))return null;const r=this.getLatestFromCache(e);if(!r)throw new Error("No cached data available after timeout");return{data:r,fromCache:!0,requestId:t,isTimeout:!0}}scheduleNetworkRequest(e,t,r,s,n,i,a,o){const d=++this.requestCounter;this.incrementRequestCounter(o);const h=this.isFirstRequestForProduct(o);if(this.debug&&(l.group(`Network Request #${d}`),l.info("Method:",e),l.info("URL:",t),l.info("Request Type:",o),l.info("Is Initial Request:",h),l.groupEnd()),!h){const l=this.getLatestFromCache(o);if(l)return this.makeNetworkRequestInBackground(e,t,r,s,n,i,a,o,d),Promise.resolve({data:l,fromCache:!0,requestId:d})}return we.scheduleTask((n=>__async(this,null,(function*(){try{const u={method:e,url:t,body:r,headers:s,requestId:d,requestType:o,abortable:!0,isInitialRequest:h};if(h){const e=yield this.makeNetworkRequest(u,n,a);if(this.markFirstRequestComplete(o),e&&e.data&&c.hasInCache(o)){const t=this.generateWriteCacheKey(o);c.addToCache(o,t,e.data)}return{data:e.data,fromCache:!1,requestId:d,responseTime:e.responseTime}}const p=Math.min(i,this.REQUEST_TIMEOUT),m=new Promise(((e,t)=>{setTimeout((()=>t({timeout:!0})),p)})),g=this.makeNetworkRequest(u,n,a);try{const e=yield Promise.race([g,m]);if(e&&e.data&&c.hasInCache(o)){const t=this.generateWriteCacheKey(o);c.addToCache(o,t,e.data)}return{data:e.data,fromCache:!1,requestId:d,responseTime:e.responseTime}}catch(l){if(l.timeout)return this.handleTimeoutResponse(o,d);throw l}}catch(u){return this.handleErrorResponse(u,o,d,h)}}))),{priority:n,type:de,name:`${e}:${o}`,timeout:i,signal:a})}makeNetworkRequest(e,t,r){return __async(this,null,(function*(){const s=new AbortController,n=()=>{s.abort()};t&&t.addEventListener("abort",n),r&&r.addEventListener("abort",n);try{const t=yield this.workerManager.executeTask(B,e,s.signal);if(t.error)throw new Error(t.error);return t}finally{t&&t.removeEventListener("abort",n),r&&r.removeEventListener("abort",n)}}))}makeNetworkRequestInBackground(e,t,r,s,n,i,a,o,d){return we.scheduleTask((n=>__async(this,null,(function*(){try{const i={method:e,url:t,body:r,headers:s,requestId:d,requestType:o,abortable:!0,isInitialRequest:!1},h=yield this.makeNetworkRequest(i,n,a);if(h&&h.data&&c.hasInCache(o)){const e=this.generateWriteCacheKey(o);c.addToCache(o,e,h.data),this.debug&&(l.group(`Background Request Completed #${d}`),l.info("Request Type:",o),l.info("Cache Updated"),l.groupEnd())}}catch(i){l.warn(`Background request #${d} failed:`,i.message)}}))),{priority:le,type:de,name:`Background:${e}:${o}`,timeout:i,signal:a})}isFirstRequestForProduct(e){return!this.firstRequestTracker.has(e)}markFirstRequestComplete(e){this.firstRequestTracker.set(e,!0)}incrementRequestCounter(e){const t=this.requestCounterMap.get(e)||0;this.requestCounterMap.set(e,t+1)}generateReadCacheKey(e){if(!c.hasInCache(e))return null;const t=c.caches.get(e);if(!t||0===t.size)return null;for(let r=Math.min(t.size-1,this.MAX_CACHE_SIZE-1);r>=0;r--){const t={variation:String(r)};if(c.getFromCache(e,t))return t}return null}generateWriteCacheKey(e){if(!c.hasInCache(e))return null;let t=(this.requestCounterMap.get(e)||0)%this.MAX_CACHE_SIZE;return 0===t?{variation:String(t)}:t>0&&t-1<this.MAX_CACHE_SIZE?{variation:String(t-1)}:{variation:"0"}}mapStringToPriority(e){switch(e.toLowerCase()){case"critical":return ie;case"high":return ae;case"normal":default:return oe;case"low":return le;case"idle":return ce}}}function ke(){return window.__ADG_WORKER_MANAGER__||(window.__ADG_WORKER_MANAGER__=new G),window.__ADG_WORKER_MANAGER__}const Te=Object.freeze(Object.defineProperty({__proto__:null,getGlobalNetworkService:function(){return window.__ADG_NETWORK_SERVICE__||(window.__ADG_NETWORK_SERVICE__=new _e(ke())),window.__ADG_NETWORK_SERVICE__},getGlobalWorkerManager:ke},Symbol.toStringTag,{value:"Module"}))}();
//# sourceMappingURL=IBN.js.map
